# Garden DX ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰
## ğŸ”§ å•é¡Œè§£æ±ºãƒ»è¨ºæ–­ã‚¬ã‚¤ãƒ‰

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [åŸºæœ¬è¨ºæ–­æ‰‹é †](#åŸºæœ¬è¨ºæ–­æ‰‹é †)
3. [ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å•é¡Œ](#ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å•é¡Œ)
4. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å•é¡Œ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å•é¡Œ)
6. [èªè¨¼ãƒ»æ¨©é™å•é¡Œ](#èªè¨¼æ¨©é™å•é¡Œ)
7. [PDFç”Ÿæˆå•é¡Œ](#pdfç”Ÿæˆå•é¡Œ)
8. [ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å•é¡Œ](#ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å•é¡Œ)
9. [ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å•é¡Œ](#ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å•é¡Œ)
10. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œ](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œ)
11. [ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå•é¡Œ](#ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå•é¡Œ)
12. [è¨ºæ–­ãƒ„ãƒ¼ãƒ«ãƒ»ã‚³ãƒãƒ³ãƒ‰](#è¨ºæ–­ãƒ„ãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰)
13. [ãƒ­ã‚°åˆ†æ](#ãƒ­ã‚°åˆ†æ)
14. [ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§](#ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§)
15. [FAQ](#faq)

---

## æ¦‚è¦

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ Garden DX ã‚·ã‚¹ãƒ†ãƒ ã§ç™ºç”Ÿã™ã‚‹ä¸€èˆ¬çš„ãªå•é¡Œã®è¨ºæ–­ã¨è§£æ±ºæ–¹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚å•é¡Œã®é‡è¦åº¦ã«å¿œã˜ã¦é©åˆ‡ãªå¯¾å¿œã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

### ğŸš¨ é‡è¦åº¦åˆ†é¡

| ãƒ¬ãƒ™ãƒ« | èª¬æ˜ | å¯¾å¿œæ™‚é–“ | ä¾‹ |
|--------|------|----------|-----|
| **P1** | ã‚·ã‚¹ãƒ†ãƒ å…¨åœæ­¢ | 15åˆ†ä»¥å†… | ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ä¸å¯ã€DBæ¥ç¶šä¸å¯ |
| **P2** | ä¸»è¦æ©Ÿèƒ½åœæ­¢ | 1æ™‚é–“ä»¥å†… | PDFç”Ÿæˆä¸å¯ã€ãƒ­ã‚°ã‚¤ãƒ³ä¸å¯ |
| **P3** | è»½å¾®ãªæ©Ÿèƒ½éšœå®³ | 4æ™‚é–“ä»¥å†… | è¡¨ç¤ºå´©ã‚Œã€ä¸€éƒ¨æ©Ÿèƒ½é…å»¶ |
| **P4** | æ”¹å–„è¦æœ› | 24æ™‚é–“ä»¥å†… | ä½¿ã„å‹æ‰‹ã®æ”¹å–„ |

### ğŸ” å•é¡Œè¨ºæ–­ã®åŸºæœ¬ãƒ•ãƒ­ãƒ¼

```
å•é¡Œç™ºç”Ÿ
    â†“
ç—‡çŠ¶ã®ç¢ºèªãƒ»è¨˜éŒ²
    â†“
åŸºæœ¬è¨ºæ–­å®Ÿè¡Œ
    â†“
ãƒ­ã‚°ç¢ºèª
    â†“
åŸå› ç‰¹å®š
    â†“
è§£æ±ºç­–é©ç”¨
    â†“
å‹•ä½œç¢ºèª
    â†“
å†ç™ºé˜²æ­¢ç­–
```

---

## åŸºæœ¬è¨ºæ–­æ‰‹é †

### ğŸ©º ã‚·ã‚¹ãƒ†ãƒ å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯

#### 1. ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
```bash
#!/bin/bash
# basic-health-check.sh

echo "ğŸ” Garden DX åŸºæœ¬è¨ºæ–­é–‹å§‹"
echo "å®Ÿè¡Œæ™‚åˆ»: $(date)"
echo "==============================="

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
echo "ğŸ“Š ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹:"
for service in garden-frontend garden-backend postgresql redis; do
    if systemctl is-active --quiet $service; then
        echo "âœ… $service: ç¨¼åƒä¸­"
    else
        echo "âŒ $service: åœæ­¢ä¸­"
        echo "   ã‚¨ãƒ©ãƒ¼è©³ç´°: $(systemctl status $service --no-pager -l | tail -3)"
    fi
done

# ãƒãƒ¼ãƒˆç¢ºèª
echo
echo "ğŸ”Œ ãƒãƒ¼ãƒˆçŠ¶æ…‹:"
for port in 3000 8000 5432 6379; do
    if ss -tuln | grep -q ":$port "; then
        echo "âœ… ãƒãƒ¼ãƒˆ $port: LISTENä¸­"
    else
        echo "âŒ ãƒãƒ¼ãƒˆ $port: æœªä½¿ç”¨"
    fi
done

# APIå¥å…¨æ€§ç¢ºèª
echo
echo "ğŸ”— APIå¥å…¨æ€§:"
API_RESPONSE=$(curl -s -w "%{http_code}" http://localhost:8000/health -o /dev/null)
if [ "$API_RESPONSE" = "200" ]; then
    echo "âœ… API: æ­£å¸¸å¿œç­” (HTTP 200)"
else
    echo "âŒ API: ç•°å¸¸å¿œç­” (HTTP $API_RESPONSE)"
fi

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
echo
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š:"
if sudo -u postgres psql -d garden_dx -c "SELECT 1;" > /dev/null 2>&1; then
    echo "âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: æ¥ç¶šæ­£å¸¸"
else
    echo "âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: æ¥ç¶šå¤±æ•—"
fi

# ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ç¢ºèª
echo
echo "ğŸ’¾ ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡:"
df -h | grep -E "($|/opt/garden-dx|/var/lib/postgresql)" | while read line; do
    usage=$(echo $line | awk '{print $5}' | sed 's/%//')
    if [ "$usage" -gt 90 ]; then
        echo "âš ï¸ $line - è­¦å‘Š: å®¹é‡ä¸è¶³"
    elif [ "$usage" -gt 80 ]; then
        echo "ğŸ”¶ $line - æ³¨æ„: å®¹é‡å¤šã‚"
    else
        echo "âœ… $line - æ­£å¸¸"
    fi
done

# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèª
echo
echo "ğŸ§  ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡:"
free -h | grep Mem | awk '{
    used=$3; total=$2; 
    print "ä½¿ç”¨ä¸­:", used, "/", total
    if (used/total > 0.9) print "âš ï¸ ãƒ¡ãƒ¢ãƒªä¸è¶³ã®å¯èƒ½æ€§"
    else print "âœ… ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æ­£å¸¸"
}'

echo
echo "ğŸ åŸºæœ¬è¨ºæ–­å®Œäº†"
```

#### 2. ã‚¯ã‚¤ãƒƒã‚¯è¨ºæ–­ã‚³ãƒãƒ³ãƒ‰
```bash
# ä¸€è¡Œã§ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª
systemctl is-active garden-frontend garden-backend postgresql redis && \
curl -s http://localhost:8000/health && \
echo "âœ… ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸"

# ä¸»è¦ãƒ­ã‚°ã®æœ€æ–°ã‚¨ãƒ©ãƒ¼ç¢ºèª
tail -20 /var/log/garden-dx/error.log | grep -E "ERROR|CRITICAL"

# ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ç¢ºèª
echo "CPU: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)%"
echo "Memory: $(free | grep Mem | awk '{printf "%.1f%%\n", $3/$2 * 100.0}')"
echo "Disk: $(df / | tail -1 | awk '{print $5}')"
```

---

## ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å•é¡Œ

### ğŸš« ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•å¤±æ•—

#### **ç—‡çŠ¶**: garden-backend ãŒèµ·å‹•ã—ãªã„
```bash
# è¨ºæ–­æ‰‹é †
echo "ğŸ” Backendèµ·å‹•å•é¡Œè¨ºæ–­"

# 1. ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹è©³ç´°ç¢ºèª
sudo systemctl status garden-backend -l

# 2. ãƒ­ã‚°ç¢ºèª
sudo journalctl -u garden-backend --since "10 minutes ago" -f

# 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
echo "ğŸ“„ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª:"
if [ -f /opt/garden-dx/backend/.env ]; then
    echo "âœ… .env ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨"
else
    echo "âŒ .env ãƒ•ã‚¡ã‚¤ãƒ«ä¸å­˜åœ¨"
fi

# 4. Pythonç’°å¢ƒç¢ºèª
echo "ğŸ Pythonç’°å¢ƒç¢ºèª:"
cd /opt/garden-dx/backend
if [ -d venv ]; then
    source venv/bin/activate
    python --version
    pip list | grep -E "(fastapi|sqlalchemy|psycopg2)"
else
    echo "âŒ ä»®æƒ³ç’°å¢ƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
fi

# 5. ãƒãƒ¼ãƒˆä½¿ç”¨çŠ¶æ³ç¢ºèª
echo "ğŸ”Œ ãƒãƒ¼ãƒˆ8000ä½¿ç”¨çŠ¶æ³:"
ss -tuln | grep 8000
lsof -i :8000
```

**ã‚ˆãã‚ã‚‹åŸå› ã¨è§£æ±ºç­–:**

1. **ç’°å¢ƒå¤‰æ•°è¨­å®šã‚¨ãƒ©ãƒ¼**
```bash
# .env ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèªãƒ»ä¿®æ­£
cd /opt/garden-dx/backend
cp .env.example .env
nano .env  # é©åˆ‡ãªå€¤ã‚’è¨­å®š

# å¿…é ˆç’°å¢ƒå¤‰æ•°ä¾‹
DATABASE_URL=postgresql://user:password@localhost:5432/garden_dx
JWT_SECRET_KEY=your-secret-key-here
CORS_ORIGINS=http://localhost:3000
```

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼**
```bash
# PostgreSQLæ¥ç¶šç¢ºèª
sudo -u postgres psql -c "SELECT version();"

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å­˜åœ¨ç¢ºèª
sudo -u postgres psql -l | grep garden_dx

# æ¥ç¶šæ¨©é™ç¢ºèª
sudo -u postgres psql -c "SELECT rolname FROM pg_roles WHERE rolcanlogin = true;"
```

3. **Pythonä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼**
```bash
# ä»®æƒ³ç’°å¢ƒå†ä½œæˆ
cd /opt/garden-dx/backend
rm -rf venv
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

4. **ãƒãƒ¼ãƒˆç«¶åˆ**
```bash
# ãƒãƒ¼ãƒˆ8000ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
sudo fuser 8000/tcp

# ãƒ—ãƒ­ã‚»ã‚¹å¼·åˆ¶çµ‚äº†
sudo kill -9 $(sudo fuser 8000/tcp 2>/dev/null)

# ä»£æ›¿ãƒãƒ¼ãƒˆä½¿ç”¨
export PORT=8001
python main.py
```

#### **ç—‡çŠ¶**: garden-frontend ãŒèµ·å‹•ã—ãªã„

```bash
# è¨ºæ–­æ‰‹é †
echo "ğŸ” Frontendèµ·å‹•å•é¡Œè¨ºæ–­"

# 1. Node.jsç’°å¢ƒç¢ºèª
node --version
npm --version

# 2. ä¾å­˜é–¢ä¿‚ç¢ºèª
cd /opt/garden-dx/app
npm ls | grep -E "(react|styled-components)" || echo "ä¾å­˜é–¢ä¿‚ã«å•é¡Œã‚ã‚Š"

# 3. ãƒ“ãƒ«ãƒ‰çŠ¶æ³ç¢ºèª
if [ -d build ]; then
    echo "âœ… ãƒ“ãƒ«ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå­˜åœ¨"
    ls -la build/
else
    echo "âŒ ãƒ“ãƒ«ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸å­˜åœ¨ - ãƒ“ãƒ«ãƒ‰å®Ÿè¡ŒãŒå¿…è¦"
    npm run build
fi

# 4. nginxè¨­å®šç¢ºèªï¼ˆæœ¬ç•ªç’°å¢ƒã®å ´åˆï¼‰
sudo nginx -t
sudo systemctl status nginx
```

**è§£æ±ºç­–:**

1. **Node.jsä¾å­˜é–¢ä¿‚ã‚¨ãƒ©ãƒ¼**
```bash
# node_moduleså†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd /opt/garden-dx/app
rm -rf node_modules package-lock.json
npm cache clean --force
npm install

# Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
node --version  # 20.x æ¨å¥¨
```

2. **ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼**
```bash
# ãƒ¡ãƒ¢ãƒªä¸è¶³ã®å ´åˆ
export NODE_OPTIONS="--max-old-space-size=8192"
npm run build

# TypeScriptã‚¨ãƒ©ãƒ¼ã®å ´åˆ
npm run typecheck
```

3. **nginxè¨­å®šã‚¨ãƒ©ãƒ¼**
```bash
# nginxè¨­å®šãƒ†ã‚¹ãƒˆ
sudo nginx -t

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
sudo nano /etc/nginx/sites-available/garden-dx

# nginxå†èµ·å‹•
sudo systemctl restart nginx
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ

### ğŸŒ å¿œç­”é€Ÿåº¦ä½ä¸‹

#### **ç—‡çŠ¶**: APIå¿œç­”ãŒé…ã„ï¼ˆ>2ç§’ï¼‰

```bash
#!/bin/bash
# performance-diagnosis.sh

echo "âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ºæ–­é–‹å§‹"

# 1. APIå¿œç­”æ™‚é–“æ¸¬å®š
echo "ğŸ“Š APIå¿œç­”æ™‚é–“æ¸¬å®š:"
for endpoint in "/health" "/api/estimates" "/api/price-master"; do
    response_time=$(curl -o /dev/null -s -w "%{time_total}" "http://localhost:8000$endpoint")
    echo "  $endpoint: ${response_time}ç§’"
    
    if (( $(echo "$response_time > 2.0" | bc -l) )); then
        echo "  âš ï¸ å¿œç­”æ™‚é–“ãŒé…ã„: $endpoint"
    fi
done

# 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª
echo
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹:"
sudo -u postgres psql -d garden_dx -c "
SELECT query, calls, total_time, mean_time 
FROM pg_stat_statements 
WHERE total_time > 1000 
ORDER BY total_time DESC 
LIMIT 5;"

# 3. ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ç¢ºèª
echo
echo "ğŸ–¥ï¸ ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹:"
echo "CPUä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}')"
echo "ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡: $(free | grep Mem | awk '{printf "%.1f%%\n", $3/$2 * 100.0}')"
echo "I/Oå¾…æ©Ÿ: $(iostat -c 1 1 | tail -1 | awk '{print $4}')%"

# 4. ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ³ç¢ºèª
echo
echo "ğŸ”„ ãƒ—ãƒ­ã‚»ã‚¹çŠ¶æ³:"
ps aux | grep -E "(garden|gunicorn|node)" | grep -v grep

# 5. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ³ç¢ºèª
echo
echo "ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ³:"
ss -tuln | grep -E "(3000|8000|5432|6379)"
```

**åŸå› ã¨è§£æ±ºç­–:**

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒª**
```sql
-- ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªç‰¹å®š
SELECT query, calls, total_time, mean_time, stddev_time
FROM pg_stat_statements 
WHERE mean_time > 100
ORDER BY mean_time DESC;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª
SELECT schemaname, tablename, indexname, idx_scan
FROM pg_stat_user_indexes
WHERE idx_scan = 0;

-- VACUUM ANALYZEå®Ÿè¡Œ
VACUUM ANALYZE;
```

2. **ãƒ¡ãƒ¢ãƒªä¸è¶³**
```bash
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡è©³ç´°ç¢ºèª
free -h
cat /proc/meminfo | grep -E "(MemTotal|MemFree|MemAvailable|Cached)"

# ã‚¹ãƒ¯ãƒƒãƒ—ä½¿ç”¨çŠ¶æ³
swapon --show

# ãƒ¡ãƒ¢ãƒªã‚’å¤šãä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹
ps aux --sort=-%mem | head -10

# è§£æ±ºç­–: ãƒ¡ãƒ¢ãƒªè¿½åŠ ã¾ãŸã¯ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–
sudo systemctl restart garden-backend  # ä¸€æ™‚çš„è§£æ±º
```

3. **CPUé«˜è² è·**
```bash
# CPUä½¿ç”¨ç‡ç¢ºèª
top -bn1 | head -20

# CPUã‚’å¤šãä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹
ps aux --sort=-%cpu | head -10

# ãƒ­ãƒ¼ãƒ‰ã‚¢ãƒ™ãƒ¬ãƒ¼ã‚¸ç¢ºèª
uptime

# è§£æ±ºç­–
sudo systemctl restart garden-backend
# ã¾ãŸã¯ workeræ•°èª¿æ•´
```

4. **I/Oå¾…æ©Ÿ**
```bash
# ãƒ‡ã‚£ã‚¹ã‚¯I/Oç¢ºèª
iostat -x 1 5

# ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡ç¢ºèª
df -h

# ãƒ‡ã‚£ã‚¹ã‚¯I/Oå¾…æ©Ÿãƒ—ãƒ­ã‚»ã‚¹ç¢ºèª
iotop -o -d 1

# è§£æ±ºç­–: ãƒ‡ã‚£ã‚¹ã‚¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
sync && echo 3 | sudo tee /proc/sys/vm/drop_caches
```

#### **ç—‡çŠ¶**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¡¨ç¤ºãŒé…ã„

```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨ºæ–­
echo "ğŸ–¼ï¸ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ºæ–­"

# 1. ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§ã®ç¢ºèªæŒ‡ç¤º
echo "ğŸ“‹ ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®ç¢ºèªé …ç›®:"
echo "1. F12 â†’ Network ã‚¿ãƒ–ã‚’é–‹ã"
echo "2. ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿"
echo "3. èª­ã¿è¾¼ã¿æ™‚é–“ãŒé•·ã„ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèª"
echo "4. Console ã‚¿ãƒ–ã§JavaScriptã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª"

# 2. é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡ç¢ºèª
echo
echo "ğŸ“¦ é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª:"
if [ -d "/opt/garden-dx/app/build/static" ]; then
    echo "âœ… ãƒ“ãƒ«ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨"
    du -sh /opt/garden-dx/app/build/static/*
else
    echo "âŒ ãƒ“ãƒ«ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ä¸å­˜åœ¨"
fi

# 3. nginxè¨­å®šç¢ºèªï¼ˆgzipåœ§ç¸®ç­‰ï¼‰
echo
echo "ğŸ—œï¸ nginxåœ§ç¸®è¨­å®šç¢ºèª:"
sudo nginx -T 2>/dev/null | grep -A 5 -B 5 gzip || echo "gzipè¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„"
```

**è§£æ±ºç­–:**

1. **ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºæœ€é©åŒ–**
```bash
# ãƒãƒ³ãƒ‰ãƒ«åˆ†æ
cd /opt/garden-dx/app
npm run build:analyze

# ä¸è¦ãªä¾å­˜é–¢ä¿‚å‰Šé™¤
npm ls --depth=0
npm uninstall <unused-package>

# ã‚³ãƒ¼ãƒ‰åˆ†å‰²å®Ÿè£…
# React.lazy() ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é…å»¶èª­ã¿è¾¼ã¿
```

2. **nginxæœ€é©åŒ–**
```nginx
# /etc/nginx/sites-available/garden-dx
server {
    # gzipåœ§ç¸®æœ‰åŠ¹åŒ–
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
    
    # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    location /static/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # åœ§ç¸®æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡
    location ~* \.(js|css)$ {
        gzip_static on;
    }
}
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å•é¡Œ

### ğŸ—„ï¸ PostgreSQL é–¢é€£å•é¡Œ

#### **ç—‡çŠ¶**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå¤±æ•—

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨ºæ–­
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨ºæ–­é–‹å§‹"

# 1. PostgreSQL ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹
sudo systemctl status postgresql

# 2. æ¥ç¶šãƒ†ã‚¹ãƒˆ
echo "ğŸ”Œ æ¥ç¶šãƒ†ã‚¹ãƒˆ:"
sudo -u postgres psql -c "SELECT version();" 2>&1

# 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
echo
echo "âš™ï¸ PostgreSQLè¨­å®šç¢ºèª:"
sudo -u postgres psql -c "SHOW config_file;"
sudo -u postgres psql -c "SHOW data_directory;"
sudo -u postgres psql -c "SHOW port;"

# 4. æ¥ç¶šæ•°ç¢ºèª
echo
echo "ğŸ“Š æ¥ç¶šæ•°ç¢ºèª:"
sudo -u postgres psql -c "
SELECT count(*) as current_connections, 
       setting as max_connections
FROM pg_stat_activity, pg_settings 
WHERE name = 'max_connections'
GROUP BY setting;"

# 5. ãƒ­ã‚°ç¢ºèª
echo
echo "ğŸ“‹ PostgreSQL ãƒ­ã‚°ç¢ºèª:"
sudo tail -20 /var/log/postgresql/postgresql-15-main.log
```

**ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–:**

1. **æ¥ç¶šæ•°ä¸Šé™è¶…é**
```sql
-- ç¾åœ¨ã®æ¥ç¶šç¢ºèª
SELECT count(*) FROM pg_stat_activity;

-- ã‚¢ã‚¤ãƒ‰ãƒ«æ¥ç¶šã®å¼·åˆ¶åˆ‡æ–­
SELECT pg_terminate_backend(pid) 
FROM pg_stat_activity 
WHERE state = 'idle' 
  AND state_change < now() - interval '30 minutes';

-- è¨­å®šå¤‰æ›´ï¼ˆpostgresql.confï¼‰
-- max_connections = 200
```

2. **èªè¨¼ã‚¨ãƒ©ãƒ¼**
```bash
# pg_hba.conf ç¢ºèª
sudo nano /etc/postgresql/15/main/pg_hba.conf

# è¨­å®šä¾‹
# local   garden_dx    garden_user                     md5
# host    garden_dx    garden_user     localhost       md5

# PostgreSQLå†èµ·å‹•
sudo systemctl restart postgresql
```

3. **ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ä¸è¶³**
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ã‚ºç¢ºèª
sudo -u postgres psql -c "
SELECT pg_database.datname, 
       pg_size_pretty(pg_database_size(pg_database.datname)) AS size
FROM pg_database;"

# å¤§ããªãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
sudo -u postgres psql -d garden_dx -c "
SELECT schemaname, tablename, 
       pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables 
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;"
```

#### **ç—‡çŠ¶**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒé‡ã„ãƒ»é…ã„

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ºæ–­
echo "âš¡ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ºæ–­"

# 1. å®Ÿè¡Œä¸­ã‚¯ã‚¨ãƒªç¢ºèª
sudo -u postgres psql -d garden_dx -c "
SELECT pid, now() - pg_stat_activity.query_start AS duration, query 
FROM pg_stat_activity 
WHERE (now() - pg_stat_activity.query_start) > interval '5 seconds'
  AND state = 'active'
ORDER BY duration DESC;"

# 2. ãƒ­ãƒƒã‚¯ç¢ºèª
sudo -u postgres psql -d garden_dx -c "
SELECT blocked_locks.pid     AS blocked_pid,
       blocked_activity.usename  AS blocked_user,
       blocking_locks.pid     AS blocking_pid,
       blocking_activity.usename AS blocking_user,
       blocked_activity.query    AS blocked_statement
FROM  pg_catalog.pg_locks         blocked_locks
JOIN pg_catalog.pg_stat_activity blocked_activity  ON blocked_activity.pid = blocked_locks.pid
JOIN pg_catalog.pg_locks         blocking_locks 
    ON blocking_locks.locktype = blocked_locks.locktype
JOIN pg_catalog.pg_stat_activity blocking_activity ON blocking_activity.pid = blocking_locks.pid
WHERE NOT blocked_locks.granted;"

# 3. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨çŠ¶æ³
sudo -u postgres psql -d garden_dx -c "
SELECT schemaname, tablename, indexname, idx_scan, idx_tup_read, idx_tup_fetch
FROM pg_stat_user_indexes
ORDER BY idx_scan DESC;"
```

**è§£æ±ºç­–:**

1. **VACUUMãƒ»ANALYZEå®Ÿè¡Œ**
```sql
-- çµ±è¨ˆæƒ…å ±æ›´æ–°
ANALYZE;

-- ä¸è¦é ˜åŸŸå›å
VACUUM;

-- è‡ªå‹•VACUUMè¨­å®šç¢ºèª
SHOW autovacuum;
```

2. **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–**
```sql
-- æœªä½¿ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª
SELECT schemaname, tablename, indexname, idx_scan
FROM pg_stat_user_indexes
WHERE idx_scan = 0;

-- å¿…è¦ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ä¾‹
CREATE INDEX CONCURRENTLY idx_estimates_customer_id ON estimates(customer_id);
CREATE INDEX CONCURRENTLY idx_estimate_items_estimate_id ON estimate_items(estimate_id);
```

3. **è¨­å®šæœ€é©åŒ–**
```bash
# postgresql.conf æœ€é©åŒ–ä¾‹
sudo nano /etc/postgresql/15/main/postgresql.conf

# ãƒ¡ãƒ¢ãƒªè¨­å®š
shared_buffers = 256MB          # ç‰©ç†ãƒ¡ãƒ¢ãƒªã®25%
effective_cache_size = 1GB      # ç‰©ç†ãƒ¡ãƒ¢ãƒªã®50-75%
work_mem = 4MB                  # æ¥ç¶šæ•°ã«å¿œã˜ã¦èª¿æ•´

# æ›¸ãè¾¼ã¿æ€§èƒ½
wal_buffers = 16MB
checkpoint_completion_target = 0.7
```

---

## èªè¨¼ãƒ»æ¨©é™å•é¡Œ

### ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ãƒ»èªè¨¼ã‚¨ãƒ©ãƒ¼

#### **ç—‡çŠ¶**: ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„

```bash
# èªè¨¼å•é¡Œè¨ºæ–­
echo "ğŸ” èªè¨¼å•é¡Œè¨ºæ–­é–‹å§‹"

# 1. JWTè¨­å®šç¢ºèª
echo "ğŸ”‘ JWTè¨­å®šç¢ºèª:"
cd /opt/garden-dx/backend
if grep -q "JWT_SECRET_KEY" .env; then
    echo "âœ… JWT_SECRET_KEYè¨­å®šæ¸ˆã¿"
else
    echo "âŒ JWT_SECRET_KEYæœªè¨­å®š"
fi

# 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼å­˜åœ¨ç¢ºèª
echo
echo "ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª (ä¾‹: test@example.com):"
sudo -u postgres psql -d garden_dx -c "
SELECT id, email, name, role, is_active 
FROM users 
WHERE email = 'test@example.com';"

# 3. èªè¨¼ãƒ­ã‚°ç¢ºèª
echo
echo "ğŸ“‹ èªè¨¼ãƒ­ã‚°ç¢ºèª:"
grep -i "authentication" /var/log/garden-dx/auth.log | tail -10

# 4. APIèªè¨¼ãƒ†ã‚¹ãƒˆ
echo
echo "ğŸ” APIèªè¨¼ãƒ†ã‚¹ãƒˆ:"
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"testpass"}' \
  -v
```

**ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–:**

1. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼å¤±æ•—**
```bash
# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ç¢ºèª
sudo -u postgres psql -d garden_dx -c "
SELECT email, password_hash 
FROM users 
WHERE email = 'test@example.com';"

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
cd /opt/garden-dx/backend
python3 -c "
from passlib.context import CryptContext
pwd_context = CryptContext(schemes=['bcrypt'], deprecated='auto')
print(pwd_context.hash('newpassword'))
"
# å‡ºåŠ›ã•ã‚ŒãŸãƒãƒƒã‚·ãƒ¥ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ›´æ–°
```

2. **JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒ©ãƒ¼**
```bash
# JWTè¨­å®šç¢ºèª
grep JWT_ /opt/garden-dx/backend/.env

# JWT_SECRET_KEYãŒæœªè¨­å®šã®å ´åˆ
echo "JWT_SECRET_KEY=$(openssl rand -hex 32)" >> /opt/garden-dx/backend/.env

# ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
sudo systemctl restart garden-backend
```

3. **CORS ã‚¨ãƒ©ãƒ¼**
```bash
# CORSè¨­å®šç¢ºèª
grep CORS_ORIGINS /opt/garden-dx/backend/.env

# è¨­å®šä¾‹
echo "CORS_ORIGINS=http://localhost:3000,https://yourdomain.com" >> .env
```

#### **ç—‡çŠ¶**: æ¨©é™ã‚¨ãƒ©ãƒ¼ï¼ˆ403 Forbiddenï¼‰

```bash
# æ¨©é™å•é¡Œè¨ºæ–­
echo "ğŸ›¡ï¸ æ¨©é™å•é¡Œè¨ºæ–­"

# 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ç¢ºèª
USER_EMAIL="test@example.com"
sudo -u postgres psql -d garden_dx -c "
SELECT email, role, is_active 
FROM users 
WHERE email = '$USER_EMAIL';"

# 2. APIã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ
echo
echo "ğŸ” æ¨©é™ãƒ†ã‚¹ãƒˆ:"
# ã¾ãšãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
TOKEN=$(curl -s -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"'$USER_EMAIL'","password":"password"}' \
  | grep -o '"access_token":"[^"]*"' | cut -d'"' -f4)

# æ¨©é™ãƒã‚§ãƒƒã‚¯
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8000/api/auth/check-permission/invoices/create
```

**è§£æ±ºç­–:**

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«å¤‰æ›´**
```sql
-- å¾“æ¥­å“¡ã‚’çµŒå–¶è€…ã«å¤‰æ›´
UPDATE users 
SET role = 'owner' 
WHERE email = 'user@example.com';

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æœ‰åŠ¹åŒ–
UPDATE users 
SET is_active = true 
WHERE email = 'user@example.com';
```

2. **æ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ç¢ºèª**
```bash
# æ¨©é™è¨­å®šç¢ºèª
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8000/api/auth/permission-matrix
```

---

## PDFç”Ÿæˆå•é¡Œ

### ğŸ“„ PDFé–¢é€£ã‚¨ãƒ©ãƒ¼

#### **ç—‡çŠ¶**: PDFç”Ÿæˆã«å¤±æ•—ã™ã‚‹

```bash
# PDFç”Ÿæˆå•é¡Œè¨ºæ–­
echo "ğŸ“„ PDFç”Ÿæˆå•é¡Œè¨ºæ–­"

# 1. PDFãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèª
echo "ğŸ“š PDFãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèª:"
cd /opt/garden-dx/backend
source venv/bin/activate
python -c "
try:
    import jspdf
    print('âœ… jsPDF: OK')
except ImportError:
    print('âŒ jsPDF: æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«')

try:
    from reportlab.pdfgen import canvas
    print('âœ… ReportLab: OK')
except ImportError:
    print('âŒ ReportLab: æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«')
"

# 2. ãƒ•ã‚©ãƒ³ãƒˆç¢ºèª
echo
echo "ğŸ”¤ ãƒ•ã‚©ãƒ³ãƒˆç¢ºèª:"
fc-list | grep -i "noto\|dejavu" | head -5

# 3. ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª
echo
echo "ğŸ“ ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª:"
ls -la /tmp/ | grep pdf
ls -la /opt/garden-dx/app/uploads/temp/

# 4. PDFç”Ÿæˆãƒ†ã‚¹ãƒˆ
echo
echo "ğŸ§ª PDFç”Ÿæˆãƒ†ã‚¹ãƒˆ:"
curl -X GET http://localhost:8000/api/demo/estimates/1/pdf \
  -o test.pdf -w "%{http_code}\n"

if [ -f test.pdf ]; then
    echo "âœ… PDFç”ŸæˆæˆåŠŸ (ã‚µã‚¤ã‚º: $(du -h test.pdf | cut -f1))"
    rm test.pdf
else
    echo "âŒ PDFç”Ÿæˆå¤±æ•—"
fi
```

**ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–:**

1. **ãƒ•ã‚©ãƒ³ãƒˆä¸è¶³**
```bash
# æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt-get update
sudo apt-get install fonts-noto-cjk fonts-dejavu-core

# ãƒ•ã‚©ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°
sudo fc-cache -fv

# ãƒ•ã‚©ãƒ³ãƒˆç¢ºèª
fc-list :lang=ja | head -5
```

2. **æ¨©é™ã‚¨ãƒ©ãƒ¼**
```bash
# ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆãƒ»æ¨©é™è¨­å®š
sudo mkdir -p /tmp/pdf_temp
sudo chown garden:garden /tmp/pdf_temp
sudo chmod 755 /tmp/pdf_temp

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚‚åŒæ§˜
sudo mkdir -p /opt/garden-dx/app/uploads/temp
sudo chown garden:garden /opt/garden-dx/app/uploads/temp
```

3. **ãƒ¡ãƒ¢ãƒªä¸è¶³**
```bash
# Python ãƒ¡ãƒ¢ãƒªåˆ¶é™ç¢ºèª
python3 -c "
import resource
print('ãƒ¡ãƒ¢ãƒªåˆ¶é™:', resource.getrlimit(resource.RLIMIT_AS))
"

# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–ã—ãªãŒã‚‰PDFç”Ÿæˆ
top -p $(pgrep -f "garden-backend") &
# PDFç”Ÿæˆå®Ÿè¡Œ
```

4. **ç”»åƒå‡¦ç†ã‚¨ãƒ©ãƒ¼**
```bash
# PIL/Pillowç¢ºèª
python3 -c "
try:
    from PIL import Image
    print('âœ… PIL: OK')
    print('å¯¾å¿œå½¢å¼:', Image.registered_extensions())
except ImportError:
    print('âŒ PIL: æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«')
"

# ç”»åƒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install Pillow
```

#### **ç—‡çŠ¶**: PDFå‡ºåŠ›å†…å®¹ãŒæ­£ã—ããªã„

```bash
# PDFå†…å®¹å•é¡Œè¨ºæ–­
echo "ğŸ” PDFå†…å®¹è¨ºæ–­"

# 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ç¢ºèª
echo "ğŸ—„ï¸ è¦‹ç©ãƒ‡ãƒ¼ã‚¿ç¢ºèª:"
sudo -u postgres psql -d garden_dx -c "
SELECT id, customer_name, project_name, total_amount 
FROM estimates 
WHERE id = 1;"

# 2. æ–‡å­—åŒ–ã‘ç¢ºèª
echo
echo "ğŸ”¤ æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç¢ºèª:"
python3 -c "
import locale
print('ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚±ãƒ¼ãƒ«:', locale.getlocale())
print('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°:', locale.getpreferredencoding())
"

# 3. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç¢ºèª
echo
echo "ğŸ“‹ PDF ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç¢ºèª:"
if [ -f "/opt/garden-dx/backend/templates/estimate.html" ]; then
    echo "âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨"
else
    echo "âŒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸å­˜åœ¨"
fi
```

**è§£æ±ºç­–:**

1. **æ–‡å­—åŒ–ã‘å¯¾ç­–**
```python
# PDFç”Ÿæˆæ™‚ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æŒ‡å®š
import os
os.environ['LANG'] = 'ja_JP.UTF-8'

# ãƒ•ã‚©ãƒ³ãƒˆæ˜ç¤ºçš„æŒ‡å®š
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont

# æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆç™»éŒ²
pdfmetrics.registerFont(TTFont('NotoSans', '/usr/share/fonts/truetype/noto/NotoSansCJK-Regular.ttc'))
```

2. **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œå¯¾ç­–**
```javascript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ PDFç”Ÿæˆæ™‚ã®CSSèª¿æ•´
const pdfOptions = {
    format: 'A4',
    margin: {
        top: '20mm',
        right: '15mm',
        bottom: '20mm',
        left: '15mm'
    },
    printBackground: true
};
```

---

## ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å•é¡Œ

### ğŸŒ æ¥ç¶šãƒ»é€šä¿¡ã‚¨ãƒ©ãƒ¼

#### **ç—‡çŠ¶**: APIé€šä¿¡ã‚¨ãƒ©ãƒ¼

```bash
# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨ºæ–­
echo "ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨ºæ–­é–‹å§‹"

# 1. ãƒãƒ¼ãƒˆé–‹æ”¾ç¢ºèª
echo "ğŸ”Œ ãƒãƒ¼ãƒˆçŠ¶æ…‹ç¢ºèª:"
for port in 3000 8000 5432 6379; do
    if nc -z localhost $port; then
        echo "âœ… ãƒãƒ¼ãƒˆ $port: æ¥ç¶šå¯èƒ½"
    else
        echo "âŒ ãƒãƒ¼ãƒˆ $port: æ¥ç¶šä¸å¯"
    fi
done

# 2. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ç¢ºèª
echo
echo "ğŸ›¡ï¸ ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ç¢ºèª:"
sudo ufw status
sudo iptables -L | grep -E "(3000|8000|5432|6379)"

# 3. DNSè§£æ±ºç¢ºèª
echo
echo "ğŸ” DNSè§£æ±ºç¢ºèª:"
nslookup localhost
ping -c 1 localhost

# 4. å¤–éƒ¨æ¥ç¶šç¢ºèª
echo
echo "ğŸŒ å¤–éƒ¨æ¥ç¶šç¢ºèª:"
curl -I https://www.google.com
```

**è§£æ±ºç­–:**

1. **ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š**
```bash
# ufw ã§ãƒãƒ¼ãƒˆé–‹æ”¾
sudo ufw allow 3000/tcp
sudo ufw allow 8000/tcp
sudo ufw allow 22/tcp  # SSH
sudo ufw enable

# iptables ã§ãƒãƒ¼ãƒˆé–‹æ”¾
sudo iptables -A INPUT -p tcp --dport 8000 -j ACCEPT
sudo iptables-save
```

2. **nginx ãƒ—ãƒ­ã‚­ã‚·è¨­å®š**
```nginx
# /etc/nginx/sites-available/garden-dx
server {
    listen 80;
    server_name yourdomain.com;

    location /api/ {
        proxy_pass http://localhost:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

#### **ç—‡çŠ¶**: SSL/HTTPS ã‚¨ãƒ©ãƒ¼

```bash
# SSLè¨ºæ–­
echo "ğŸ”’ SSLè¨ºæ–­"

# 1. è¨¼æ˜æ›¸ç¢ºèª
echo "ğŸ“œ SSLè¨¼æ˜æ›¸ç¢ºèª:"
openssl x509 -in /etc/letsencrypt/live/yourdomain.com/cert.pem -text -noout | grep -E "(Issuer|Not After)"

# 2. è¨¼æ˜æ›¸æœ‰åŠ¹æœŸé™
echo
echo "ğŸ“… è¨¼æ˜æ›¸æœ‰åŠ¹æœŸé™:"
openssl x509 -enddate -noout -in /etc/letsencrypt/live/yourdomain.com/cert.pem

# 3. SSLè¨­å®šãƒ†ã‚¹ãƒˆ
echo
echo "ğŸ§ª SSLè¨­å®šãƒ†ã‚¹ãƒˆ:"
curl -I https://yourdomain.com

# 4. nginx SSLè¨­å®šç¢ºèª
echo
echo "âš™ï¸ nginx SSLè¨­å®š:"
sudo nginx -T | grep -A 10 -B 10 ssl
```

**è§£æ±ºç­–:**

1. **Let's Encrypt è¨¼æ˜æ›¸æ›´æ–°**
```bash
# è¨¼æ˜æ›¸æ›´æ–°
sudo certbot renew

# å¼·åˆ¶æ›´æ–°
sudo certbot renew --force-renewal

# nginxå†èµ·å‹•
sudo systemctl restart nginx
```

2. **SSLè¨­å®šæœ€é©åŒ–**
```nginx
# nginx SSLè¨­å®šä¾‹
server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
    ssl_prefer_server_ciphers off;
    
    add_header Strict-Transport-Security "max-age=63072000" always;
}
```

---

## ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å•é¡Œ

### ğŸ’¾ ãƒ‡ã‚£ã‚¹ã‚¯ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«é–¢é€£

#### **ç—‡çŠ¶**: ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ä¸è¶³

```bash
# ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¨ºæ–­
echo "ğŸ’¾ ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¨ºæ–­"

# 1. ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ç¢ºèª
echo "ğŸ“Š ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡:"
df -h

# 2. å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç‰¹å®š
echo
echo "ğŸ“ å¤§ããªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª TOP10:"
sudo du -sh /* 2>/dev/null | sort -hr | head -10

# 3. Garden DX é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
echo
echo "ğŸŒ± Garden DX ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º:"
du -sh /opt/garden-dx/*
du -sh /var/log/garden-dx/
du -sh /opt/garden-dx/backups/

# 4. ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
echo
echo "ğŸ—‘ï¸ å‰Šé™¤å¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«:"
find /tmp -name "garden-dx-*" -mtime +1 -exec ls -lh {} \;
find /var/log/garden-dx -name "*.log.*" -mtime +30 -exec ls -lh {} \;
```

**è§£æ±ºç­–:**

1. **ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç†**
```bash
# å¤ã„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
find /var/log/garden-dx -name "*.log.*" -mtime +30 -delete

# ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¼·åˆ¶å®Ÿè¡Œ
sudo logrotate -f /etc/logrotate.d/garden-dx

# åœ§ç¸®ã•ã‚Œã¦ã„ãªã„ãƒ­ã‚°ã®åœ§ç¸®
find /var/log/garden-dx -name "*.log" -size +100M -exec gzip {} \;
```

2. **ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤**
```bash
# ã‚·ã‚¹ãƒ†ãƒ ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
sudo find /tmp -type f -atime +7 -delete

# Garden DX ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
find /opt/garden-dx/app/uploads/temp -mtime +1 -delete
find /tmp -name "garden-dx-*" -mtime +1 -delete
```

3. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç†**
```bash
# å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‰Šé™¤ï¼ˆ90æ—¥ä»¥ä¸Šï¼‰
find /opt/garden-dx/backups -name "*.sql.gz" -mtime +90 -delete

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚µã‚¤ã‚ºç¢ºèª
ls -lah /opt/garden-dx/backups/ | tail -10
```

4. **Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ»ã‚³ãƒ³ãƒ†ãƒŠå‰Šé™¤**
```bash
# æœªä½¿ç”¨Dockerã‚¤ãƒ¡ãƒ¼ã‚¸å‰Šé™¤
docker image prune -a -f

# åœæ­¢ä¸­ã‚³ãƒ³ãƒ†ãƒŠå‰Šé™¤
docker container prune -f

# æœªä½¿ç”¨ãƒœãƒªãƒ¥ãƒ¼ãƒ å‰Šé™¤
docker volume prune -f
```

#### **ç—‡çŠ¶**: ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™ã‚¨ãƒ©ãƒ¼

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™è¨ºæ–­
echo "ğŸ” ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™è¨ºæ–­"

# 1. Garden DX ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™ç¢ºèª
echo "ğŸ“ Garden DX ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¨©é™:"
ls -la /opt/garden-dx/

# 2. é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ç¢ºèª
echo
echo "ğŸ“„ é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™:"
ls -la /opt/garden-dx/backend/.env
ls -la /opt/garden-dx/app/uploads/
ls -la /var/log/garden-dx/

# 3. ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª
echo
echo "ğŸ‘¤ ãƒ—ãƒ­ã‚»ã‚¹å®Ÿè¡Œãƒ¦ãƒ¼ã‚¶ãƒ¼:"
ps aux | grep -E "(garden|gunicorn|node)" | grep -v grep
```

**è§£æ±ºç­–:**

1. **é©åˆ‡ãªæ¨©é™è¨­å®š**
```bash
# Garden DX ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ‰€æœ‰è€…å¤‰æ›´
sudo chown -R garden:garden /opt/garden-dx/

# å®Ÿè¡Œæ¨©é™è¨­å®š
sudo chmod +x /opt/garden-dx/scripts/*.sh

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰
sudo chmod 600 /opt/garden-dx/backend/.env

# ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¨©é™
sudo chown -R garden:garden /var/log/garden-dx/
sudo chmod 755 /var/log/garden-dx/
```

2. **systemd ã‚µãƒ¼ãƒ“ã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š**
```ini
# /etc/systemd/system/garden-backend.service
[Service]
User=garden
Group=garden
WorkingDirectory=/opt/garden-dx/backend
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œ

### ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¨ãƒ©ãƒ¼ãƒ»è„…å¨

#### **ç—‡çŠ¶**: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥

```bash
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­
echo "ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­é–‹å§‹"

# 1. å¤±æ•—ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œç¢ºèª
echo "ğŸ” å¤±æ•—ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œ:"
grep "authentication failed" /var/log/garden-dx/auth.log | tail -10

# 2. ç•°å¸¸ãªAPIã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª
echo
echo "ğŸš¨ ç•°å¸¸ãªAPIã‚¢ã‚¯ã‚»ã‚¹:"
awk '{print $1}' /var/log/garden-dx/api.log | sort | uniq -c | sort -nr | head -10

# 3. fail2bançŠ¶æ…‹ç¢ºèª
echo
echo "ğŸš« fail2bançŠ¶æ…‹:"
sudo fail2ban-client status
sudo fail2ban-client status garden-dx-auth

# 4. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«çŠ¶æ…‹
echo
echo "ğŸ”¥ ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«çŠ¶æ…‹:"
sudo ufw status numbered

# 5. é–‹æ”¾ãƒãƒ¼ãƒˆç¢ºèª
echo
echo "ğŸ”Œ é–‹æ”¾ãƒãƒ¼ãƒˆç¢ºèª:"
sudo ss -tuln | grep LISTEN
```

**å¯¾å¿œç­–:**

1. **fail2ban è¨­å®šå¼·åŒ–**
```bash
# fail2banè¨­å®šæ›´æ–°
sudo nano /etc/fail2ban/jail.d/garden-dx.conf

# ã‚ˆã‚Šå³ã—ã„è¨­å®šä¾‹
[garden-dx-auth]
enabled = true
maxretry = 3      # 3å›å¤±æ•—ã§BAN
bantime = 3600    # 1æ™‚é–“BAN
findtime = 300    # 5åˆ†é–“ã®ç›£è¦–

# fail2banå†èµ·å‹•
sudo systemctl restart fail2ban
```

2. **IP ã‚¢ãƒ‰ãƒ¬ã‚¹æ‰‹å‹•BAN**
```bash
# ç‰¹å®šIPã‚’æ‰‹å‹•BAN
sudo fail2ban-client set garden-dx-auth banip 192.168.1.100

# BANè§£é™¤
sudo fail2ban-client set garden-dx-auth unbanip 192.168.1.100

# BANä¸€è¦§ç¢ºèª
sudo fail2ban-client status garden-dx-auth
```

3. **ãƒ­ã‚°ç›£è¦–å¼·åŒ–**
```bash
# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–
tail -f /var/log/garden-dx/auth.log | while read line; do
    if echo "$line" | grep -q "authentication failed"; then
        echo "ğŸš¨ ALERT: $line"
        # Slacké€šçŸ¥ãªã©ã®å‡¦ç†
    fi
done
```

#### **ç—‡çŠ¶**: SSL/TLS è„†å¼±æ€§

```bash
# SSL ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­
echo "ğŸ”’ SSL ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­"

# 1. SSL Labs ãƒ†ã‚¹ãƒˆï¼ˆå¤–éƒ¨ï¼‰
echo "ğŸŒ SSL Labs ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ:"
echo "https://www.ssllabs.com/ssltest/analyze.html?d=yourdomain.com"

# 2. ãƒ­ãƒ¼ã‚«ãƒ« SSL è¨­å®šç¢ºèª
echo
echo "âš™ï¸ SSLè¨­å®šç¢ºèª:"
sudo nginx -T | grep -A 20 "ssl_"

# 3. è¨¼æ˜æ›¸ãƒã‚§ãƒ¼ãƒ³ç¢ºèª
echo
echo "ğŸ”— è¨¼æ˜æ›¸ãƒã‚§ãƒ¼ãƒ³ç¢ºèª:"
openssl s_client -connect yourdomain.com:443 -servername yourdomain.com < /dev/null

# 4. æš—å·åŒ–ã‚¹ã‚¤ãƒ¼ãƒˆç¢ºèª
echo
echo "ğŸ” æš—å·åŒ–ã‚¹ã‚¤ãƒ¼ãƒˆç¢ºèª:"
nmap --script ssl-enum-ciphers -p 443 yourdomain.com
```

**å¼·åŒ–ç­–:**

1. **nginx SSL è¨­å®šå¼·åŒ–**
```nginx
# å¼·åŒ–ã•ã‚ŒãŸSSLè¨­å®š
ssl_protocols TLSv1.2 TLSv1.3;
ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;
ssl_prefer_server_ciphers off;

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ 
add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
add_header X-Frame-Options DENY always;
add_header X-Content-Type-Options nosniff always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "no-referrer-when-downgrade" always;
```

2. **DH ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¼·åŒ–**
```bash
# å¼·åŠ›ãªDHãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç”Ÿæˆ
sudo openssl dhparam -out /etc/nginx/dhparam.pem 2048

# nginxè¨­å®šã«è¿½åŠ 
ssl_dhparam /etc/nginx/dhparam.pem;
```

---

## ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå•é¡Œ

### ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“é–¢é€£

#### **ç—‡çŠ¶**: ç”»é¢è¡¨ç¤ºç•°å¸¸ãƒ»æ“ä½œä¸èƒ½

```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å•é¡Œè¨ºæ–­
echo "ğŸ–¼ï¸ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å•é¡Œè¨ºæ–­"

# 1. ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ç¢ºèª
echo "ğŸŒ æ¨å¥¨ãƒ–ãƒ©ã‚¦ã‚¶ç¢ºèªæŒ‡ç¤º:"
echo "- Chrome 90+ âœ…"
echo "- Firefox 88+ âœ…"
echo "- Safari 14+ âœ…"
echo "- Edge 90+ âœ…"

# 2. JavaScript ã‚¨ãƒ©ãƒ¼ç¢ºèªæŒ‡ç¤º
echo
echo "âš ï¸ ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç¢ºèª:"
echo "1. F12 ã‚­ãƒ¼ã‚’æŠ¼ã™"
echo "2. Console ã‚¿ãƒ–ã‚’é–‹ã"
echo "3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª"
echo "4. èµ¤ã„ã‚¨ãƒ©ãƒ¼è¡Œã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ"

# 3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ç¢ºèªæŒ‡ç¤º
echo
echo "ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¢ºèª:"
echo "1. F12 â†’ Network ã‚¿ãƒ–"
echo "2. ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰"
echo "3. èµ¤ã„ã‚¨ãƒ©ãƒ¼ï¼ˆ4xx, 5xxï¼‰ã‚’ç¢ºèª"

# 4. ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç¢ºèªæŒ‡ç¤º
echo
echo "ğŸ’¾ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç¢ºèª:"
echo "1. F12 â†’ Application ã‚¿ãƒ–"
echo "2. Local Storage â†’ localhost"
echo "3. 'token' ã‚­ãƒ¼ã®å­˜åœ¨ç¢ºèª"
```

**è§£æ±ºç­–:**

1. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢**
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘æ‰‹é †:
1. Ctrl + Shift + Deleteï¼ˆWindowsï¼‰/ Cmd + Shift + Deleteï¼ˆMacï¼‰
2. ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸç”»åƒã¨ãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚’ãƒã‚§ãƒƒã‚¯
3. ã€Œå‰Šé™¤ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ï¼ˆF5ï¼‰
```

2. **JavaScript ã‚¨ãƒ©ãƒ¼å¯¾å¿œ**
```javascript
// ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨å¯¾å‡¦æ³•

// 1. TypeError: Cannot read property 'xxx' of undefined
// â†’ ãƒ‡ãƒ¼ã‚¿ãŒæœªèª­ã¿è¾¼ã¿ã®å¯èƒ½æ€§
// å¯¾å‡¦: null/undefined ãƒã‚§ãƒƒã‚¯è¿½åŠ 

// 2. Network Error / Failed to fetch
// â†’ APIæ¥ç¶šã‚¨ãƒ©ãƒ¼
// å¯¾å‡¦: ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç¢ºèª

// 3. SyntaxError: Unexpected token
// â†’ JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼
// å¯¾å‡¦: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ç¢ºèª
```

3. **æ¨©é™ã‚¨ãƒ©ãƒ¼ç”»é¢å¯¾å¿œ**
```javascript
// æ¨©é™ã‚¨ãƒ©ãƒ¼æ™‚ã®è¡¨ç¤ºæ”¹å–„
const ErrorBoundary = ({ children }) => {
  const [hasError, setHasError] = useState(false);
  
  if (hasError) {
    return (
      <div>
        <h2>æ¨©é™ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h2>
        <p>ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„</p>
        <button onClick={() => window.location.reload()}>
          ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿
        </button>
      </div>
    );
  }
  
  return children;
};
```

#### **ç—‡çŠ¶**: ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ»æ›´æ–°å¤±æ•—

```bash
# ãƒ‡ãƒ¼ã‚¿æ“ä½œå•é¡Œè¨ºæ–­
echo "ğŸ’¾ ãƒ‡ãƒ¼ã‚¿æ“ä½œå•é¡Œè¨ºæ–­"

# 1. API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç–é€šç¢ºèª
echo "ğŸ”— APIç–é€šç¢ºèª:"
curl -X GET http://localhost:8000/api/estimates -H "Authorization: Bearer TOKEN"

# 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
echo
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª:"
sudo -u postgres psql -d garden_dx -c "SELECT COUNT(*) FROM estimates;"

# 3. æ¨©é™ç¢ºèª
echo
echo "ğŸ” æ¨©é™ç¢ºèª:"
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³ã§ã®æ¨©é™ãƒ†ã‚¹ãƒˆ
curl -H "Authorization: Bearer TOKEN" \
  http://localhost:8000/api/auth/check-permission/estimates/create

# 4. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ç¢ºèª
echo
echo "âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª:"
echo "å¿…é ˆé …ç›®ãŒå…¨ã¦å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª"
echo "æ–‡å­—æ•°åˆ¶é™ã‚’è¶…ãˆã¦ã„ãªã„ã‹ç¢ºèª"
echo "æ•°å€¤é …ç›®ã«ä¸æ­£ãªå€¤ãŒå…¥ã£ã¦ã„ãªã„ã‹ç¢ºèª"
```

**è§£æ±ºç­–:**

1. **ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼å¼·åŒ–**
```javascript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–
const validateEstimate = (data) => {
  const errors = {};
  
  if (!data.customer_name || data.customer_name.trim() === '') {
    errors.customer_name = 'é¡§å®¢åã¯å¿…é ˆã§ã™';
  }
  
  if (!data.project_name || data.project_name.trim() === '') {
    errors.project_name = 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯å¿…é ˆã§ã™';
  }
  
  if (!data.items || data.items.length === 0) {
    errors.items = 'è¦‹ç©é …ç›®ã‚’1ã¤ä»¥ä¸Šè¿½åŠ ã—ã¦ãã ã•ã„';
  }
  
  return errors;
};
```

2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ”¹å–„**
```javascript
// API ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
const handleApiError = (error) => {
  if (error.response) {
    // ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
    const status = error.response.status;
    const message = error.response.data?.message || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
    
    switch (status) {
      case 400:
        alert(`å…¥åŠ›ã‚¨ãƒ©ãƒ¼: ${message}`);
        break;
      case 401:
        alert('èªè¨¼ã‚¨ãƒ©ãƒ¼: å†ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„');
        // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        break;
      case 403:
        alert('æ¨©é™ã‚¨ãƒ©ãƒ¼: ã“ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');
        break;
      case 500:
        alert('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„');
        break;
      default:
        alert(`ã‚¨ãƒ©ãƒ¼: ${message}`);
    }
  } else if (error.request) {
    // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
    alert('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„');
  } else {
    // ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼
    alert('äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  }
};
```

---

## è¨ºæ–­ãƒ„ãƒ¼ãƒ«ãƒ»ã‚³ãƒãƒ³ãƒ‰

### ğŸ”§ ä¾¿åˆ©ãªè¨ºæ–­ã‚³ãƒãƒ³ãƒ‰é›†

#### ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±åé›†
```bash
#!/bin/bash
# system-diagnostic.sh - ç·åˆè¨ºæ–­ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

echo "ğŸ” Garden DX ç·åˆè¨ºæ–­é–‹å§‹"
echo "======================================="

# åŸºæœ¬æƒ…å ±
echo "ğŸ“‹ åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±:"
echo "OS: $(cat /etc/os-release | grep PRETTY_NAME | cut -d= -f2 | tr -d '\"')"
echo "ã‚«ãƒ¼ãƒãƒ«: $(uname -r)"
echo "ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ : $(uptime -p)"
echo "ç¾åœ¨æ™‚åˆ»: $(date)"

# ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æƒ…å ±
echo
echo "ğŸ–¥ï¸ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æƒ…å ±:"
echo "CPU: $(grep -m1 'model name' /proc/cpuinfo | cut -d: -f2 | xargs)"
echo "CPUã‚³ã‚¢æ•°: $(nproc)"
echo "ãƒ¡ãƒ¢ãƒªç·å®¹é‡: $(free -h | grep Mem | awk '{print $2}')"
echo "ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡: $(df -h / | tail -1 | awk '{print $2}')"

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹
echo
echo "ğŸ”„ ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹:"
services=("garden-frontend" "garden-backend" "postgresql" "redis" "nginx")
for service in "${services[@]}"; do
    if systemctl is-active --quiet $service 2>/dev/null; then
        echo "âœ… $service: ç¨¼åƒä¸­"
    else
        echo "âŒ $service: åœæ­¢ä¸­ã¾ãŸã¯æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
    fi
done

# ãƒãƒ¼ãƒˆçŠ¶æ…‹
echo
echo "ğŸ”Œ ãƒãƒ¼ãƒˆçŠ¶æ…‹:"
ports=(22 80 443 3000 8000 5432 6379)
for port in "${ports[@]}"; do
    if ss -tuln | grep -q ":$port "; then
        echo "âœ… ãƒãƒ¼ãƒˆ $port: LISTENä¸­"
    else
        echo "âšª ãƒãƒ¼ãƒˆ $port: æœªä½¿ç”¨"
    fi
done

# ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³
echo
echo "ğŸ“Š ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³:"
echo "CPUä½¿ç”¨ç‡: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)%"
echo "ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡: $(free | grep Mem | awk '{printf "%.1f%%\n", $3/$2 * 100.0}')"
echo "ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡: $(df / | tail -1 | awk '{print $5}')"
echo "ãƒ­ãƒ¼ãƒ‰ã‚¢ãƒ™ãƒ¬ãƒ¼ã‚¸: $(uptime | awk -F'load average:' '{print $2}')"

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±
echo
echo "ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±:"
echo "IPã‚¢ãƒ‰ãƒ¬ã‚¹: $(hostname -I | awk '{print $1}')"
echo "ãƒ›ã‚¹ãƒˆå: $(hostname)"
echo "DNS: $(cat /etc/resolv.conf | grep nameserver | head -1 | awk '{print $2}')"

# Garden DX å›ºæœ‰æƒ…å ±
echo
echo "ğŸŒ± Garden DX æƒ…å ±:"
if [ -d "/opt/garden-dx" ]; then
    echo "ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: âœ… å­˜åœ¨"
    cd /opt/garden-dx 2>/dev/null
    if [ -d ".git" ]; then
        echo "ãƒãƒ¼ã‚¸ãƒ§ãƒ³: $(git describe --tags --always 2>/dev/null || echo 'ä¸æ˜')"
        echo "æœ€çµ‚ã‚³ãƒŸãƒƒãƒˆ: $(git log -1 --format='%h %s' 2>/dev/null || echo 'ä¸æ˜')"
    fi
else
    echo "ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: âŒ ä¸å­˜åœ¨"
fi

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±
echo
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±:"
if sudo -u postgres psql -d garden_dx -c "SELECT version();" > /dev/null 2>&1; then
    echo "PostgreSQLæ¥ç¶š: âœ… æ­£å¸¸"
    DB_SIZE=$(sudo -u postgres psql -d garden_dx -t -c "SELECT pg_size_pretty(pg_database_size('garden_dx'));" 2>/dev/null | xargs)
    echo "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ã‚º: $DB_SIZE"
    USER_COUNT=$(sudo -u postgres psql -d garden_dx -t -c "SELECT COUNT(*) FROM users;" 2>/dev/null | xargs)
    echo "ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: $USER_COUNTäºº"
    ESTIMATE_COUNT=$(sudo -u postgres psql -d garden_dx -t -c "SELECT COUNT(*) FROM estimates;" 2>/dev/null | xargs)
    echo "è¦‹ç©æ•°: $ESTIMATE_COUNTä»¶"
else
    echo "PostgreSQLæ¥ç¶š: âŒ å¤±æ•—"
fi

# APIå¥å…¨æ€§
echo
echo "ğŸ”— APIå¥å…¨æ€§:"
API_STATUS=$(curl -s -w "%{http_code}" http://localhost:8000/health -o /dev/null 2>/dev/null)
if [ "$API_STATUS" = "200" ]; then
    echo "APIå¿œç­”: âœ… æ­£å¸¸ (HTTP 200)"
    API_RESPONSE_TIME=$(curl -o /dev/null -s -w "%{time_total}" http://localhost:8000/health 2>/dev/null)
    echo "APIå¿œç­”æ™‚é–“: ${API_RESPONSE_TIME}ç§’"
else
    echo "APIå¿œç­”: âŒ ç•°å¸¸ (HTTP $API_STATUS)"
fi

echo
echo "ğŸ è¨ºæ–­å®Œäº†"
echo "======================================="
```

#### ãƒ­ã‚°è§£æãƒ„ãƒ¼ãƒ«
```bash
#!/bin/bash
# log-analyzer.sh - ãƒ­ã‚°åˆ†æãƒ„ãƒ¼ãƒ«

DAYS=${1:-1}
echo "ğŸ“‹ Garden DX ãƒ­ã‚°åˆ†æï¼ˆéå» $DAYS æ—¥é–“ï¼‰"

# ã‚¨ãƒ©ãƒ¼çµ±è¨ˆ
echo "âŒ ã‚¨ãƒ©ãƒ¼çµ±è¨ˆ:"
find /var/log/garden-dx -name "*.log" -mtime -$DAYS -exec \
    grep -h "ERROR\|CRITICAL\|FATAL" {} \; 2>/dev/null | \
    wc -l | awk '{print "ç·ã‚¨ãƒ©ãƒ¼æ•°: " $1 "ä»¶"}'

# ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—åˆ¥é›†è¨ˆ
echo
echo "ğŸ“Š ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—åˆ¥:"
find /var/log/garden-dx -name "*.log" -mtime -$DAYS -exec \
    grep -h "ERROR\|CRITICAL\|FATAL" {} \; 2>/dev/null | \
    awk '{print $3}' | sort | uniq -c | sort -nr

# API ã‚¢ã‚¯ã‚»ã‚¹çµ±è¨ˆ
echo
echo "ğŸ”— API ã‚¢ã‚¯ã‚»ã‚¹çµ±è¨ˆ:"
if [ -f "/var/log/garden-dx/api.log" ]; then
    echo "ç·ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°: $(wc -l < /var/log/garden-dx/api.log)ä»¶"
    echo "ãƒ¦ãƒ‹ãƒ¼ã‚¯IPæ•°: $(awk '{print $1}' /var/log/garden-dx/api.log | sort -u | wc -l)å€‹"
    
    echo
    echo "äººæ°—ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ TOP5:"
    grep -o '"[A-Z]* /[^"]*"' /var/log/garden-dx/api.log 2>/dev/null | \
        sort | uniq -c | sort -nr | head -5
fi

# èªè¨¼çµ±è¨ˆ
echo
echo "ğŸ” èªè¨¼çµ±è¨ˆ:"
if [ -f "/var/log/garden-dx/auth.log" ]; then
    echo "ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: $(grep -c "login success" /var/log/garden-dx/auth.log 2>/dev/null)ä»¶"
    echo "ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: $(grep -c "authentication failed" /var/log/garden-dx/auth.log 2>/dev/null)ä»¶"
fi

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ
echo
echo "âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ:"
if [ -f "/var/log/garden-dx/performance.log" ]; then
    echo "å¹³å‡å¿œç­”æ™‚é–“: $(awk '{sum+=$NF; count++} END {printf "%.2fms\n", sum/count}' /var/log/garden-dx/performance.log 2>/dev/null)"
fi
```

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
```bash
#!/bin/bash
# performance-test.sh - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

echo "âš¡ Garden DX ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ"

# API å¿œç­”æ™‚é–“æ¸¬å®š
echo "ğŸ”— APIå¿œç­”æ™‚é–“æ¸¬å®š:"
endpoints=(
    "/health"
    "/api/auth/user-features" 
    "/api/estimates?limit=10"
    "/api/price-master?limit=10"
)

for endpoint in "${endpoints[@]}"; do
    echo -n "  $endpoint: "
    response_time=$(curl -o /dev/null -s -w "%{time_total}" "http://localhost:8000$endpoint" 2>/dev/null)
    http_code=$(curl -o /dev/null -s -w "%{http_code}" "http://localhost:8000$endpoint" 2>/dev/null)
    
    if [ "$http_code" = "200" ]; then
        echo "${response_time}ç§’ âœ…"
    else
        echo "HTTP $http_code âŒ"
    fi
done

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¿œç­”æ™‚é–“
echo
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¿œç­”æ™‚é–“:"
if sudo -u postgres psql -d garden_dx -c "SELECT 1;" > /dev/null 2>&1; then
    db_time=$(time (sudo -u postgres psql -d garden_dx -c "SELECT COUNT(*) FROM estimates;" > /dev/null) 2>&1 | grep real | awk '{print $2}')
    echo "  SELECT COUNT(*): $db_time âœ…"
else
    echo "  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š: å¤±æ•— âŒ"
fi

# ãƒ¡ãƒ¢ãƒªãƒ»CPUä½¿ç”¨ç‡
echo
echo "ğŸ–¥ï¸ ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨ç‡:"
echo "  CPU: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)%"
echo "  ãƒ¡ãƒ¢ãƒª: $(free | grep Mem | awk '{printf "%.1f%%", $3/$2 * 100.0}')"
echo "  ãƒ‡ã‚£ã‚¹ã‚¯: $(df / | tail -1 | awk '{print $5}')"
```

---

## ãƒ­ã‚°åˆ†æ

### ğŸ“‹ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
/var/log/garden-dx/
â”œâ”€â”€ app.log           # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨èˆ¬ãƒ­ã‚°
â”œâ”€â”€ error.log         # ã‚¨ãƒ©ãƒ¼å°‚ç”¨ãƒ­ã‚°
â”œâ”€â”€ auth.log          # èªè¨¼é–¢é€£ãƒ­ã‚°
â”œâ”€â”€ api.log           # API ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°
â”œâ”€â”€ performance.log   # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ­ã‚°
â”œâ”€â”€ security.log      # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°
â””â”€â”€ debug.log         # ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
```

### ğŸ” ãƒ­ã‚°åˆ†æã‚³ãƒãƒ³ãƒ‰

#### ã‚¨ãƒ©ãƒ¼åˆ†æ
```bash
# ç›´è¿‘ã®ã‚¨ãƒ©ãƒ¼ç¢ºèª
tail -20 /var/log/garden-dx/error.log

# ç‰¹å®šæœŸé–“ã®ã‚¨ãƒ©ãƒ¼ä»¶æ•°
grep "$(date -d '1 hour ago' '+%Y-%m-%d %H:')" /var/log/garden-dx/error.log | wc -l

# ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—åˆ¥é›†è¨ˆ
grep "ERROR\|CRITICAL" /var/log/garden-dx/error.log | \
  awk '{print $4}' | sort | uniq -c | sort -nr

# ç‰¹å®šã‚¨ãƒ©ãƒ¼ã®è©³ç´°
grep -A 5 -B 5 "database connection" /var/log/garden-dx/error.log
```

#### API ã‚¢ã‚¯ã‚»ã‚¹åˆ†æ
```bash
# ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°é›†è¨ˆ
awk '{print $1}' /var/log/garden-dx/api.log | sort | uniq -c | sort -nr | head -10

# ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ©ç”¨çµ±è¨ˆ
grep -o '"[A-Z]* /[^"]*"' /var/log/garden-dx/api.log | \
  sort | uniq -c | sort -nr | head -10

# å¿œç­”ã‚³ãƒ¼ãƒ‰åˆ¥çµ±è¨ˆ
awk '{print $9}' /var/log/garden-dx/api.log | sort | uniq -c | sort -nr

# æ™‚é–“åˆ¥ã‚¢ã‚¯ã‚»ã‚¹æ•°
awk '{print $4}' /var/log/garden-dx/api.log | \
  cut -d: -f2 | sort | uniq -c
```

#### èªè¨¼ãƒ­ã‚°åˆ†æ
```bash
# ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸãƒ»å¤±æ•—çµ±è¨ˆ
echo "ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: $(grep -c "login success" /var/log/garden-dx/auth.log)ä»¶"
echo "ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: $(grep -c "authentication failed" /var/log/garden-dx/auth.log)ä»¶"

# å¤±æ•—ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œã®è©³ç´°
grep "authentication failed" /var/log/garden-dx/auth.log | \
  awk '{print $1}' | sort | uniq -c | sort -nr

# æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
grep "user created" /var/log/garden-dx/auth.log | tail -10
```

---

## ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§

### ğŸ”¢ HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰

| ã‚³ãƒ¼ãƒ‰ | æ„å‘³ | ã‚ˆãã‚ã‚‹åŸå›  | å¯¾å‡¦æ³• |
|--------|------|-------------|---------|
| **400** | Bad Request | ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼ã‚¨ãƒ©ãƒ¼ | å…¥åŠ›ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ |
| **401** | Unauthorized | èªè¨¼å¤±æ•— | ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ç¢ºèª |
| **403** | Forbidden | æ¨©é™ä¸è¶³ | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ç¢ºèª |
| **404** | Not Found | ãƒªã‚½ãƒ¼ã‚¹ä¸å­˜åœ¨ | URLãƒ»ãƒ‡ãƒ¼ã‚¿å­˜åœ¨ç¢ºèª |
| **422** | Unprocessable Entity | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | å…¥åŠ›å€¤æ¤œè¨¼ |
| **500** | Internal Server Error | ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼ | ãƒ­ã‚°ç¢ºèªãƒ»å†èµ·å‹• |
| **502** | Bad Gateway | ãƒ—ãƒ­ã‚­ã‚·ã‚¨ãƒ©ãƒ¼ | nginxè¨­å®šç¢ºèª |
| **503** | Service Unavailable | ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ | ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª |
| **504** | Gateway Timeout | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | å‡¦ç†æ™‚é–“ãƒ»è² è·ç¢ºèª |

### ğŸš¨ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã‚¨ãƒ©ãƒ¼

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ | å¯¾å‡¦æ³• |
|-------------|------|---------|
| **AUTH_001** | JWT ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹ | å†ãƒ­ã‚°ã‚¤ãƒ³ |
| **AUTH_002** | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼å¤±æ•— | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª |
| **AUTH_003** | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç„¡åŠ¹åŒ– | ç®¡ç†è€…ã«é€£çµ¡ |
| **DATA_001** | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ | DBçŠ¶æ…‹ç¢ºèª |
| **DATA_002** | å¿…é ˆé …ç›®æœªå…¥åŠ› | å…¥åŠ›é …ç›®ç¢ºèª |
| **DATA_003** | ãƒ‡ãƒ¼ã‚¿é‡è¤‡ã‚¨ãƒ©ãƒ¼ | æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ç¢ºèª |
| **PDF_001** | PDFç”Ÿæˆå¤±æ•— | ãƒ•ã‚©ãƒ³ãƒˆãƒ»æ¨©é™ç¢ºèª |
| **PDF_002** | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸æ­£ | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿®æ­£ |
| **FILE_001** | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•— | ã‚µã‚¤ã‚ºãƒ»å½¢å¼ç¢ºèª |
| **PERM_001** | æ¨©é™ä¸è¶³ï¼ˆçµŒå–¶è€…æ©Ÿèƒ½ï¼‰ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ç¢ºèª |

---

## FAQ

### â“ ã‚ˆãã‚ã‚‹è³ªå•ã¨å›ç­”

#### Q1: ã‚·ã‚¹ãƒ†ãƒ ãŒé‡ãæ„Ÿã˜ã‚‹ã®ã§ã™ãŒï¼Ÿ
**A**: ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
1. ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒ90%æœªæº€ã‹ç¢ºèª
2. ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡ãŒ85%æœªæº€ã‹ç¢ºèª  
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
4. åŒæ™‚å®Ÿè¡Œä¸­ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª

```bash
# ç°¡æ˜“ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯
free -h && df -h && top -bn1 | head -5
```

#### Q2: PDFãŒç”Ÿæˆã•ã‚Œãªã„ã®ã§ã™ãŒï¼Ÿ
**A**: ä»¥ä¸‹ã®é †åºã§ç¢ºèªã—ã¦ãã ã•ã„ï¼š
1. æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹
2. ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¨©é™ãŒæ­£ã—ã„ã‹
3. ãƒ¡ãƒ¢ãƒªä¸è¶³ã§ã¯ãªã„ã‹
4. è¦‹ç©ãƒ‡ãƒ¼ã‚¿ã«å•é¡ŒãŒãªã„ã‹

```bash
# PDFç”Ÿæˆè¨ºæ–­
fc-list | grep -i noto
ls -la /tmp/pdf_temp/
curl http://localhost:8000/api/demo/estimates/1/pdf -o test.pdf
```

#### Q3: ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„ã®ã§ã™ãŒï¼Ÿ
**A**: ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒæœ‰åŠ¹ã‹
2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ã„ã‹ï¼ˆå¤§æ–‡å­—ãƒ»å°æ–‡å­—åŒºåˆ¥ï¼‰
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®CookieãŒæœ‰åŠ¹ã‹
4. JWTãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®šãŒæ­£ã—ã„ã‹

```bash
# ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ç¢ºèª
sudo -u postgres psql -d garden_dx -c "
SELECT email, is_active, role FROM users WHERE email = 'your@email.com';"
```

#### Q4: ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œãªã„ã®ã§ã™ãŒï¼Ÿ
**A**: ä»¥ä¸‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼š
1. å¿…é ˆé …ç›®ãŒã™ã¹ã¦å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒæ­£å¸¸ã‹
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¿å­˜æ¨©é™ãŒã‚ã‚‹ã‹
4. ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ãŒååˆ†ã‹

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
sudo -u postgres psql -d garden_dx -c "SELECT 1;"
```

#### Q5: ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã—ãªã„ã®ã§ã™ãŒï¼Ÿ
**A**: ä»¥ä¸‹ã®é †åºã§ç¢ºèªï¼š
1. ä¾å­˜ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆPostgreSQLã€Redisï¼‰ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹
2. ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
3. ãƒãƒ¼ãƒˆãŒä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ã«ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã‹
4. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

```bash
# ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•è¨ºæ–­
systemctl status garden-backend
journalctl -u garden-backend --since "5 minutes ago"
ss -tuln | grep -E "(3000|8000)"
```

#### Q6: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ã©ã†ç¢ºèªã™ã‚Œã°ã‚ˆã„ã§ã™ã‹ï¼Ÿ
**A**: ä»¥ä¸‹ã§ç¢ºèªã§ãã¾ã™ï¼š
```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
ls -la /opt/garden-dx/backups/ | head -10

# æœ€æ–°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ã‚µã‚¤ã‚ºç¢ºèª
ls -lah /opt/garden-dx/backups/*.sql.gz | tail -1

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®æ•´åˆæ€§ãƒ†ã‚¹ãƒˆ
sudo -u postgres pg_restore --list /opt/garden-dx/backups/latest.sql.gz
```

#### Q7: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã™ã‚‹æ–¹æ³•ã¯ï¼Ÿ
**A**: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é€šçŸ¥ã®æ–¹æ³•ï¼š
```bash
# ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–
touch /opt/garden-dx/maintenance.flag

# nginx ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç”»é¢è¡¨ç¤º
# location / {
#     if (-f /opt/garden-dx/maintenance.flag) {
#         return 503;
#     }
# }
```

#### Q8: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆãŒé »ç™ºã™ã‚‹ã®ã§ã™ãŒï¼Ÿ
**A**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’ç¢ºèªï¼š
```bash
# fail2ban çŠ¶æ…‹ç¢ºèª
sudo fail2ban-client status garden-dx-auth

# æœ€è¿‘ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆç¢ºèª
tail -20 /var/log/garden-dx/security.log

# ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šç¢ºèª
sudo ufw status numbered
```

---

**Garden DX ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ v1.0**  
**æœ€çµ‚æ›´æ–°æ—¥: 2024å¹´7æœˆ6æ—¥**  
**ä½œæˆè€…: Garden DX ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚µãƒãƒ¼ãƒˆãƒãƒ¼ãƒ **

Â© 2024 Garden DX. All rights reserved.

---

### ğŸ“ ã‚µãƒãƒ¼ãƒˆé€£çµ¡å…ˆ

**ç·Šæ€¥æ™‚é€£çµ¡å…ˆ:**
- ğŸ“§ Email: support@garden-dx.com
- ğŸ“± é›»è©±: 0120-XXX-XXXï¼ˆ24æ™‚é–“å¯¾å¿œï¼‰
- ğŸ’¬ Slack: #garden-dx-support

**ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:**
- Level 1: ä¸€èˆ¬çš„ãªå•é¡Œ
- Level 2: æŠ€è¡“çš„å•é¡Œ  
- Level 3: ç·Šæ€¥ã‚·ã‚¹ãƒ†ãƒ éšœå®³
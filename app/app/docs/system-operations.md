# Garden DX ã‚·ã‚¹ãƒ†ãƒ é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
## ğŸ”§ ç®¡ç†è€…å‘ã‘é‹ç”¨ãƒ»ä¿å®ˆã‚¬ã‚¤ãƒ‰

---

## ğŸ“‹ ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [é‹ç”¨ç’°å¢ƒ](#é‹ç”¨ç’°å¢ƒ)
3. [æ—¥å¸¸é‹ç”¨](#æ—¥å¸¸é‹ç”¨)
4. [ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ](#ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆ)
5. [ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§](#ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¾©æ—§)
6. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†)
7. [ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†](#ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†)
8. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç®¡ç†](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç®¡ç†)
9. [ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹](#ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹)
10. [ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ](#ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ)
11. [é‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ](#é‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ)
12. [ãƒ­ã‚°ç®¡ç†](#ãƒ­ã‚°ç®¡ç†)

---

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

Garden DX ã¯ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ§‹æˆã•ã‚Œã‚‹3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Presentation  â”‚    â”‚    Application  â”‚    â”‚      Data       â”‚
â”‚      Layer      â”‚    â”‚      Layer      â”‚    â”‚     Layer       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ React Frontend  â”‚â—„â”€â”€â–ºâ”‚ FastAPI Backend â”‚â—„â”€â”€â–ºâ”‚ PostgreSQL DB   â”‚
â”‚ Nginx Proxy     â”‚    â”‚ Redis Cache     â”‚    â”‚ File Storage    â”‚
â”‚ Load Balancer   â”‚    â”‚ Background Job  â”‚    â”‚ Log Storage     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

#### æœ€å°ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶
- **CPU**: 4ã‚³ã‚¢ä»¥ä¸Š
- **ãƒ¡ãƒ¢ãƒª**: 8GBä»¥ä¸Š  
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: 100GBä»¥ä¸Šï¼ˆSSDæ¨å¥¨ï¼‰
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: 100Mbpsä»¥ä¸Š

#### æ¨å¥¨ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
- **CPU**: 8ã‚³ã‚¢ä»¥ä¸Š
- **ãƒ¡ãƒ¢ãƒª**: 16GBä»¥ä¸Š
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: 500GBä»¥ä¸Šï¼ˆNVMe SSDï¼‰
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: 1Gbpsä»¥ä¸Š

---

## é‹ç”¨ç’°å¢ƒ

### ğŸ—ï¸ ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ

#### æœ¬ç•ªç’°å¢ƒæ§‹æˆ
```
Internet
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Load Balancerâ”‚ (nginx)
â”‚   (SSL)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend   â”‚    â”‚  Backend    â”‚
â”‚   (React)   â”‚    â”‚ (FastAPI)   â”‚
â”‚   nginx     â”‚    â”‚  Gunicorn   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PostgreSQL  â”‚    â”‚   Redis     â”‚
    â”‚   (Main)    â”‚    â”‚  (Cache)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ PostgreSQL  â”‚
    â”‚  (Backup)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é–‹ç™ºãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ
```yaml
# docker-compose.yml ã«ã‚ˆã‚‹æ§‹æˆ
services:
  frontend:
    image: garden-dx/frontend:latest
    ports: ["3000:3000"]
  
  backend:
    image: garden-dx/backend:latest
    ports: ["8000:8000"]
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/garden_dx
  
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=garden_dx
  
  redis:
    image: redis:7-alpine
```

### ğŸ”§ ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†

#### Systemd ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

**Frontend ã‚µãƒ¼ãƒ“ã‚¹**
```ini
# /etc/systemd/system/garden-frontend.service
[Unit]
Description=Garden DX Frontend
After=network.target

[Service]
Type=simple
User=garden
WorkingDirectory=/opt/garden-dx/app
ExecStart=/usr/bin/node server.js
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**Backend ã‚µãƒ¼ãƒ“ã‚¹**
```ini
# /etc/systemd/system/garden-backend.service
[Unit]
Description=Garden DX Backend
After=network.target postgresql.service

[Service]
Type=simple
User=garden
WorkingDirectory=/opt/garden-dx/backend
ExecStart=/opt/garden-dx/backend/venv/bin/gunicorn main:app \
  --bind 0.0.0.0:8000 \
  --workers 4 \
  --worker-class uvicorn.workers.UvicornWorker
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### ã‚µãƒ¼ãƒ“ã‚¹æ“ä½œã‚³ãƒãƒ³ãƒ‰
```bash
# ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹
sudo systemctl start garden-frontend garden-backend

# ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
sudo systemctl stop garden-frontend garden-backend

# ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
sudo systemctl restart garden-frontend garden-backend

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
sudo systemctl status garden-frontend garden-backend

# è‡ªå‹•èµ·å‹•æœ‰åŠ¹åŒ–
sudo systemctl enable garden-frontend garden-backend

# ãƒ­ã‚°ç¢ºèª
sudo journalctl -u garden-backend -f
```

---

## æ—¥å¸¸é‹ç”¨

### ğŸ“… æ—¥æ¬¡é‹ç”¨ã‚¿ã‚¹ã‚¯

#### æœã®å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯
```bash
#!/bin/bash
# daily-health-check.sh

echo "ğŸŒ… Garden DX æ—¥æ¬¡å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯é–‹å§‹"
echo "å®Ÿè¡Œæ—¥æ™‚: $(date)"

# 1. ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
echo "ğŸ“Š ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯..."
systemctl is-active garden-frontend garden-backend postgres redis

# 2. ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ç¢ºèª
echo "ğŸ’¾ ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯..."
df -h | grep -E "(/$|/opt/garden-dx|/var/lib/postgresql)"

# 3. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèª
echo "ğŸ§  ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯..."
free -h

# 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒã‚§ãƒƒã‚¯..."
sudo -u postgres psql -d garden_dx -c "SELECT version();" > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š: æ­£å¸¸"
else
    echo "âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š: ç•°å¸¸"
fi

# 5. API å¥å…¨æ€§ç¢ºèª
echo "ğŸ”— APIå¥å…¨æ€§ãƒã‚§ãƒƒã‚¯..."
curl -s http://localhost:8000/health | grep -q "healthy"
if [ $? -eq 0 ]; then
    echo "âœ… API: æ­£å¸¸"
else
    echo "âŒ API: ç•°å¸¸"
fi

# 6. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª
echo "ğŸ”„ æœ€æ–°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª..."
LATEST_BACKUP=$(ls -t /opt/garden-dx/backups/*.sql 2>/dev/null | head -1)
if [ -n "$LATEST_BACKUP" ]; then
    BACKUP_DATE=$(stat -c %y "$LATEST_BACKUP" | cut -d' ' -f1)
    echo "âœ… æœ€æ–°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: $BACKUP_DATE"
else
    echo "âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
fi

echo "ğŸ å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯å®Œäº†"
```

#### å¤œé–“ãƒãƒƒãƒå‡¦ç†
```bash
#!/bin/bash
# nightly-maintenance.sh

echo "ğŸŒ™ Garden DX å¤œé–“ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é–‹å§‹"

# 1. ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
echo "ğŸ“‹ ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ..."
sudo logrotate /etc/logrotate.d/garden-dx

# 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±è¨ˆæ›´æ–°
echo "ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±è¨ˆæ›´æ–°..."
sudo -u postgres psql -d garden_dx -c "ANALYZE;"

# 3. ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
echo "ğŸ—‘ï¸ ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤..."
find /tmp -name "garden-dx-*" -mtime +1 -delete
find /opt/garden-dx/app/uploads/temp -mtime +1 -delete

# 4. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
echo "ğŸ§¹ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—..."
redis-cli FLUSHDB

# 5. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
echo "ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ..."
./backup-database.sh

echo "ğŸ å¤œé–“ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Œäº†"
```

### ğŸ“ˆ é€±æ¬¡é‹ç”¨ã‚¿ã‚¹ã‚¯

#### é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
```bash
#!/bin/bash
# weekly-report.sh

REPORT_DATE=$(date +%Y%m%d)
REPORT_FILE="/opt/garden-dx/reports/weekly-report-$REPORT_DATE.md"

cat > "$REPORT_FILE" << EOF
# Garden DX é€±æ¬¡é‹ç”¨ãƒ¬ãƒãƒ¼ãƒˆ
## æœŸé–“: $(date -d '1 week ago' +%Y/%m/%d) - $(date +%Y/%m/%d)

### ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒçŠ¶æ³
- ç¨¼åƒç‡: $(calc_uptime)%
- å¹³å‡å¿œç­”æ™‚é–“: $(calc_avg_response)ms
- ã‚¨ãƒ©ãƒ¼ç‡: $(calc_error_rate)%

### åˆ©ç”¨çµ±è¨ˆ
- ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: $(count_active_users)äºº
- è¦‹ç©ä½œæˆæ•°: $(count_estimates)ä»¶
- PDFç”Ÿæˆæ•°: $(count_pdf_generations)ä»¶

### ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³
- CPUä½¿ç”¨ç‡å¹³å‡: $(calc_avg_cpu)%
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡å¹³å‡: $(calc_avg_memory)%
- ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡: $(calc_disk_usage)%

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆ
- ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—æ•°: $(count_failed_logins)å›
- ç•°å¸¸ã‚¢ã‚¯ã‚»ã‚¹æ•°: $(count_suspicious_access)å›

### æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
$(generate_recommendations)
EOF

echo "ğŸ“Š é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ: $REPORT_FILE"
```

---

## ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ

### ğŸ“Š ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

#### Prometheus è¨­å®š
```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "garden-dx-rules.yml"

scrape_configs:
  - job_name: 'garden-dx-backend'
    static_configs:
      - targets: ['localhost:8000']
    metrics_path: '/metrics'
    
  - job_name: 'garden-dx-frontend'
    static_configs:
      - targets: ['localhost:3000']
      
  - job_name: 'postgresql'
    static_configs:
      - targets: ['localhost:9187']

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093
```

#### ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ«
```yaml
# garden-dx-rules.yml
groups:
- name: garden-dx-alerts
  rules:
  # APIå¿œç­”æ™‚é–“ã‚¢ãƒ©ãƒ¼ãƒˆ
  - alert: HighAPIResponseTime
    expr: http_request_duration_seconds > 2
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "APIå¿œç­”æ™‚é–“ãŒé…å»¶ã—ã¦ã„ã¾ã™"
      description: "APIå¿œç­”æ™‚é–“ãŒ{{ $value }}ç§’ã§ã™"

  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¢ãƒ©ãƒ¼ãƒˆ
  - alert: DatabaseConnectionDown
    expr: pg_up == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒå¤±ã‚ã‚Œã¾ã—ãŸ"
      
  # ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã‚¢ãƒ©ãƒ¼ãƒˆ
  - alert: HighDiskUsage
    expr: (node_filesystem_size_bytes - node_filesystem_free_bytes) / node_filesystem_size_bytes > 0.85
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡ãŒ85%ã‚’è¶…ãˆã¾ã—ãŸ"

  # ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ã‚¢ãƒ©ãƒ¼ãƒˆ
  - alert: HighMemoryUsage
    expr: (node_memory_MemTotal_bytes - node_memory_MemFree_bytes) / node_memory_MemTotal_bytes > 0.90
    for: 3m
    labels:
      severity: critical
    annotations:
      summary: "ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒ90%ã‚’è¶…ãˆã¾ã—ãŸ"

  # ã‚¨ãƒ©ãƒ¼ç‡ã‚¢ãƒ©ãƒ¼ãƒˆ
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) > 0.1
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "ã‚¨ãƒ©ãƒ¼ç‡ãŒ10%ã‚’è¶…ãˆã¾ã—ãŸ"
```

#### Grafana ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**ä¸»è¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–**
```json
{
  "dashboard": {
    "title": "Garden DX ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–",
    "panels": [
      {
        "title": "APIå¿œç­”æ™‚é–“",
        "type": "graph",
        "targets": [
          {
            "expr": "http_request_duration_seconds",
            "legendFormat": "APIå¿œç­”æ™‚é–“"
          }
        ]
      },
      {
        "title": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ•°",
        "type": "stat",
        "targets": [
          {
            "expr": "pg_stat_activity_count",
            "legendFormat": "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶š"
          }
        ]
      },
      {
        "title": "ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°/åˆ†",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[1m]) * 60",
            "legendFormat": "ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†"
          }
        ]
      }
    ]
  }
}
```

### ğŸš¨ ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥è¨­å®š

#### Slack é€šçŸ¥è¨­å®š
```yaml
# alertmanager.yml
global:
  slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'garden-dx-alerts'

receivers:
- name: 'garden-dx-alerts'
  slack_configs:
  - channel: '#garden-dx-alerts'
    title: 'Garden DX ã‚¢ãƒ©ãƒ¼ãƒˆ'
    text: |
      {{ range .Alerts }}
      ã‚¢ãƒ©ãƒ¼ãƒˆ: {{ .Annotations.summary }}
      è©³ç´°: {{ .Annotations.description }}
      {{ end }}
```

#### ãƒ¡ãƒ¼ãƒ«é€šçŸ¥è¨­å®š
```bash
# ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡
send_alert_email() {
    local SUBJECT="$1"
    local MESSAGE="$2"
    local RECIPIENT="admin@garden-dx.com"
    
    echo "$MESSAGE" | mail -s "Garden DX Alert: $SUBJECT" "$RECIPIENT"
}

# ä½¿ç”¨ä¾‹
if [ $(check_disk_usage) -gt 85 ]; then
    send_alert_email "ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ä¸è¶³" "ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡ãŒ85%ã‚’è¶…ãˆã¾ã—ãŸ"
fi
```

---

## ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§

### ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

#### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¨®åˆ¥

1. **ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: æ—¥æ¬¡å®Ÿè¡Œï¼ˆæ·±å¤œ2:00ï¼‰
2. **å·®åˆ†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: 6æ™‚é–“æ¯å®Ÿè¡Œ
3. **ãƒ­ã‚°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: ç¶™ç¶šçš„å®Ÿè¡Œï¼ˆWALï¼‰
4. **è¨­å®šãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: é€±æ¬¡å®Ÿè¡Œ

#### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**
```bash
#!/bin/bash
# backup-database.sh

BACKUP_DIR="/opt/garden-dx/backups"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/garden-dx-full-$DATE.sql"

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p "$BACKUP_DIR"

# ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
echo "ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é–‹å§‹: $DATE"

sudo -u postgres pg_dump -Fc garden_dx > "$BACKUP_FILE"

if [ $? -eq 0 ]; then
    echo "âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆåŠŸ: $BACKUP_FILE"
    
    # åœ§ç¸®
    gzip "$BACKUP_FILE"
    
    # å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‰Šé™¤ï¼ˆ30æ—¥ä»¥ä¸Šï¼‰
    find "$BACKUP_DIR" -name "*.sql.gz" -mtime +30 -delete
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚µã‚¤ã‚ºç¢ºèª
    BACKUP_SIZE=$(du -h "${BACKUP_FILE}.gz" | cut -f1)
    echo "ğŸ“Š ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚µã‚¤ã‚º: $BACKUP_SIZE"
    
else
    echo "âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¤±æ•—"
    exit 1
fi
```

**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**
```bash
#!/bin/bash
# backup-application.sh

BACKUP_DIR="/opt/garden-dx/backups"
DATE=$(date +%Y%m%d_%H%M%S)
APP_BACKUP_FILE="$BACKUP_DIR/garden-dx-app-$DATE.tar.gz"

echo "ğŸ”„ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é–‹å§‹"

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
tar -czf "$APP_BACKUP_FILE" \
    --exclude="node_modules" \
    --exclude="__pycache__" \
    --exclude="*.log" \
    --exclude="venv" \
    /opt/garden-dx/app \
    /opt/garden-dx/backend \
    /etc/nginx/sites-available/garden-dx \
    /etc/systemd/system/garden-*.service

if [ $? -eq 0 ]; then
    echo "âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆåŠŸ: $APP_BACKUP_FILE"
else
    echo "âŒ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¤±æ•—"
    exit 1
fi
```

#### è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š

**Crontab è¨­å®š**
```bash
# Garden DX ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
# æ¯æ—¥æ·±å¤œ2:00ã«ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
0 2 * * * /opt/garden-dx/scripts/backup-database.sh >> /var/log/garden-dx/backup.log 2>&1

# 6æ™‚é–“æ¯ã«å·®åˆ†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
0 */6 * * * /opt/garden-dx/scripts/backup-incremental.sh >> /var/log/garden-dx/backup.log 2>&1

# æ¯é€±æ—¥æ›œæ—¥ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
0 3 * * 0 /opt/garden-dx/scripts/backup-application.sh >> /var/log/garden-dx/backup.log 2>&1

# æ¯æ—¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¤œè¨¼
0 4 * * * /opt/garden-dx/scripts/verify-backup.sh >> /var/log/garden-dx/backup.log 2>&1
```

### ğŸ”„ ç½å®³å¾©æ—§æ‰‹é †

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©æ—§
```bash
#!/bin/bash
# restore-database.sh

BACKUP_FILE="$1"

if [ -z "$BACKUP_FILE" ]; then
    echo "ä½¿ç”¨æ³•: $0 <backup_file>"
    exit 1
fi

echo "ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©æ—§é–‹å§‹: $BACKUP_FILE"

# ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
sudo systemctl stop garden-backend garden-frontend

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©æ—§
sudo -u postgres dropdb garden_dx
sudo -u postgres createdb garden_dx
sudo -u postgres pg_restore -d garden_dx "$BACKUP_FILE"

if [ $? -eq 0 ]; then
    echo "âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©æ—§æˆåŠŸ"
    
    # ã‚µãƒ¼ãƒ“ã‚¹å†é–‹
    sudo systemctl start garden-backend garden-frontend
    
    # å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯
    sleep 10
    curl -s http://localhost:8000/health | grep -q "healthy"
    if [ $? -eq 0 ]; then
        echo "âœ… ã‚·ã‚¹ãƒ†ãƒ å¾©æ—§å®Œäº†"
    else
        echo "âŒ ã‚·ã‚¹ãƒ†ãƒ å¾©æ—§ç¢ºèªã§ã‚¨ãƒ©ãƒ¼"
    fi
else
    echo "âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¾©æ—§å¤±æ•—"
    exit 1
fi
```

#### ãƒã‚¤ãƒ³ãƒˆãƒ»ã‚¤ãƒ³ãƒ»ã‚¿ã‚¤ãƒ ãƒ»ãƒªã‚«ãƒãƒªï¼ˆPITRï¼‰
```bash
#!/bin/bash
# pitr-recovery.sh

TARGET_TIME="$1"  # ä¾‹: 2024-07-06 15:30:00

if [ -z "$TARGET_TIME" ]; then
    echo "ä½¿ç”¨æ³•: $0 '2024-07-06 15:30:00'"
    exit 1
fi

echo "ğŸ• ãƒã‚¤ãƒ³ãƒˆãƒ»ã‚¤ãƒ³ãƒ»ã‚¿ã‚¤ãƒ ãƒ»ãƒªã‚«ãƒãƒªé–‹å§‹: $TARGET_TIME"

# PostgreSQLåœæ­¢
sudo systemctl stop postgresql

# WALãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å¾©æ—§
sudo -u postgres pg_ctl start -D /var/lib/postgresql/15/main \
    -o "-c recovery_target_time='$TARGET_TIME'"

echo "âœ… PITRå®Œäº†: $TARGET_TIME"
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†

### ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–

#### ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œç›£è¦–
```bash
#!/bin/bash
# security-monitor.sh

LOGFILE="/var/log/garden-dx/auth.log"
THRESHOLD=5
TIMEFRAME=300  # 5åˆ†é–“

# å¤±æ•—ã—ãŸãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œã‚’ç›£è¦–
monitor_failed_logins() {
    FAILED_ATTEMPTS=$(grep "authentication failed" "$LOGFILE" | \
        awk -v threshold=$(date -d '5 minutes ago' +%s) \
        '{ if (systime() - threshold <= 300) print }' | wc -l)
    
    if [ "$FAILED_ATTEMPTS" -gt "$THRESHOLD" ]; then
        echo "ğŸš¨ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆ: å¤±æ•—ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡ŒãŒå¤šæ•°æ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
        echo "éå»5åˆ†é–“ã§ $FAILED_ATTEMPTS å›ã®å¤±æ•—"
        
        # IPåˆ¥ã®å¤±æ•—è©¦è¡Œçµ±è¨ˆ
        grep "authentication failed" "$LOGFILE" | \
            tail -$FAILED_ATTEMPTS | \
            awk '{print $1}' | sort | uniq -c | sort -nr
    fi
}

# ç•°å¸¸ãªAPIã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ç›£è¦–
monitor_api_access() {
    API_LOGFILE="/var/log/garden-dx/api.log"
    
    # çŸ­æ™‚é–“ã§ã®å¤§é‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œå‡º
    SUSPICIOUS_IPS=$(awk -v threshold=$(date -d '1 minute ago' +%s) \
        '$4 > threshold {print $1}' "$API_LOGFILE" | \
        sort | uniq -c | awk '$1 > 100 {print $2}')
    
    if [ -n "$SUSPICIOUS_IPS" ]; then
        echo "ğŸš¨ ç•°å¸¸ãªAPI ã‚¢ã‚¯ã‚»ã‚¹æ¤œå‡º:"
        echo "$SUSPICIOUS_IPS"
    fi
}

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–å®Ÿè¡Œ
monitor_failed_logins
monitor_api_access
```

#### ä¾µå…¥æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆIDSï¼‰è¨­å®š
```bash
#!/bin/bash
# ids-setup.sh

# fail2banè¨­å®š
cat > /etc/fail2ban/jail.d/garden-dx.conf << EOF
[garden-dx-auth]
enabled = true
port = 8000
filter = garden-dx-auth
logpath = /var/log/garden-dx/auth.log
maxretry = 5
bantime = 3600
findtime = 600

[garden-dx-api]
enabled = true
port = 8000
filter = garden-dx-api
logpath = /var/log/garden-dx/api.log
maxretry = 50
bantime = 1800
findtime = 300
EOF

# ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å®šç¾©
cat > /etc/fail2ban/filter.d/garden-dx-auth.conf << EOF
[Definition]
failregex = authentication failed.*<HOST>
ignoreregex =
EOF

# fail2banå†èµ·å‹•
sudo systemctl restart fail2ban
```

### ğŸ” SSL/TLS è¨¼æ˜æ›¸ç®¡ç†

#### Let's Encrypt è¨¼æ˜æ›¸è‡ªå‹•æ›´æ–°
```bash
#!/bin/bash
# ssl-renewal.sh

DOMAIN="yourdomain.com"
CERT_PATH="/etc/letsencrypt/live/$DOMAIN"

# è¨¼æ˜æ›¸æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯
check_cert_expiry() {
    EXPIRY_DATE=$(openssl x509 -enddate -noout -in "$CERT_PATH/cert.pem" | cut -d= -f2)
    EXPIRY_EPOCH=$(date -d "$EXPIRY_DATE" +%s)
    CURRENT_EPOCH=$(date +%s)
    DAYS_LEFT=$(( (EXPIRY_EPOCH - CURRENT_EPOCH) / 86400 ))
    
    echo "ğŸ“… SSLè¨¼æ˜æ›¸æœ‰åŠ¹æœŸé™ã¾ã§: $DAYS_LEFT æ—¥"
    
    # 30æ—¥ä»¥å†…ã«æœŸé™åˆ‡ã‚Œã®å ´åˆã¯æ›´æ–°
    if [ "$DAYS_LEFT" -lt 30 ]; then
        echo "ğŸ”„ SSLè¨¼æ˜æ›¸æ›´æ–°é–‹å§‹..."
        certbot renew --quiet
        
        if [ $? -eq 0 ]; then
            echo "âœ… SSLè¨¼æ˜æ›¸æ›´æ–°æˆåŠŸ"
            sudo systemctl reload nginx
        else
            echo "âŒ SSLè¨¼æ˜æ›¸æ›´æ–°å¤±æ•—"
            # ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡
            send_alert_email "SSLè¨¼æ˜æ›¸æ›´æ–°å¤±æ•—" "SSLè¨¼æ˜æ›¸ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ"
        fi
    fi
}

check_cert_expiry
```

---

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†

### ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†

#### æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
```bash
#!/bin/bash
# create-user.sh

EMAIL="$1"
NAME="$2"
ROLE="$3"  # owner ã¾ãŸã¯ employee

if [ $# -ne 3 ]; then
    echo "ä½¿ç”¨æ³•: $0 <email> <name> <role>"
    echo "ä¾‹: $0 test@example.com 'ãƒ†ã‚¹ãƒˆå¤ªéƒ' employee"
    exit 1
fi

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ 
sudo -u postgres psql -d garden_dx << EOF
INSERT INTO users (email, name, role, is_active, created_at)
VALUES ('$EMAIL', '$NAME', '$ROLE', true, NOW());
EOF

if [ $? -eq 0 ]; then
    echo "âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆæˆåŠŸ: $EMAIL"
    echo "ğŸ“§ æ‹›å¾…ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¦ãã ã•ã„"
else
    echo "âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆå¤±æ•—"
fi
```

#### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
```bash
#!/bin/bash
# reset-password.sh

EMAIL="$1"

if [ -z "$EMAIL" ]; then
    echo "ä½¿ç”¨æ³•: $0 <email>"
    exit 1
fi

# ä¸€æ™‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ
TEMP_PASSWORD=$(openssl rand -base64 12)

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–
HASHED_PASSWORD=$(python3 -c "
from passlib.context import CryptContext
pwd_context = CryptContext(schemes=['bcrypt'], deprecated='auto')
print(pwd_context.hash('$TEMP_PASSWORD'))
")

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°
sudo -u postgres psql -d garden_dx << EOF
UPDATE users 
SET password_hash = '$HASHED_PASSWORD', 
    must_change_password = true 
WHERE email = '$EMAIL';
EOF

if [ $? -eq 0 ]; then
    echo "âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæˆåŠŸ"
    echo "ğŸ“§ ä¸€æ™‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: $TEMP_PASSWORD"
    echo "âš ï¸  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å®‰å…¨ã«ä¼é”ã—ã¦ãã ã•ã„"
else
    echo "âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆå¤±æ•—"
fi
```

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼æ´»å‹•ç›£è¦–
```bash
#!/bin/bash
# user-activity-report.sh

DAYS="${1:-7}"  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ7æ—¥é–“

echo "ğŸ“Š ãƒ¦ãƒ¼ã‚¶ãƒ¼æ´»å‹•ãƒ¬ãƒãƒ¼ãƒˆï¼ˆéå» $DAYS æ—¥é–“ï¼‰"
echo "ç”Ÿæˆæ—¥æ™‚: $(date)"
echo

# ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
ACTIVE_USERS=$(sudo -u postgres psql -d garden_dx -t -c "
SELECT COUNT(DISTINCT user_id) 
FROM user_activity_logs 
WHERE created_at >= NOW() - INTERVAL '$DAYS days';
")

echo "ğŸ”¥ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: $ACTIVE_USERS äºº"

# ãƒ­ã‚°ã‚¤ãƒ³å›æ•°ãƒˆãƒƒãƒ—10
echo
echo "ğŸ“ˆ ãƒ­ã‚°ã‚¤ãƒ³å›æ•°ãƒˆãƒƒãƒ—10:"
sudo -u postgres psql -d garden_dx -c "
SELECT u.name, u.email, COUNT(*) as login_count
FROM user_activity_logs ual
JOIN users u ON ual.user_id = u.id
WHERE ual.action = 'login' 
  AND ual.created_at >= NOW() - INTERVAL '$DAYS days'
GROUP BY u.id, u.name, u.email
ORDER BY login_count DESC
LIMIT 10;
"

# æ©Ÿèƒ½åˆ©ç”¨çµ±è¨ˆ
echo
echo "ğŸ¯ æ©Ÿèƒ½åˆ©ç”¨çµ±è¨ˆ:"
sudo -u postgres psql -d garden_dx -c "
SELECT action, COUNT(*) as count
FROM user_activity_logs
WHERE created_at >= NOW() - INTERVAL '$DAYS days'
GROUP BY action
ORDER BY count DESC;
"
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç®¡ç†

### âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
```bash
#!/bin/bash
# db-performance-monitor.sh

echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–"
echo "ç›£è¦–æ™‚åˆ»: $(date)"

# æ¥ç¶šæ•°ç¢ºèª
echo "ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ•°:"
sudo -u postgres psql -d garden_dx -c "
SELECT state, COUNT(*) 
FROM pg_stat_activity 
WHERE datname = 'garden_dx'
GROUP BY state;
"

# å®Ÿè¡Œä¸­ã®ã‚¯ã‚¨ãƒªç¢ºèª
echo
echo "ğŸ”„ å®Ÿè¡Œä¸­ã®ã‚¯ã‚¨ãƒªï¼ˆ1ç§’ä»¥ä¸Šï¼‰:"
sudo -u postgres psql -d garden_dx -c "
SELECT pid, now() - pg_stat_activity.query_start AS duration, query 
FROM pg_stat_activity 
WHERE (now() - pg_stat_activity.query_start) > interval '1 seconds'
  AND state = 'active'
ORDER BY duration DESC;
"

# ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªãƒ­ã‚°è§£æ
echo
echo "ğŸŒ ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªï¼ˆéå»24æ™‚é–“ï¼‰:"
sudo -u postgres psql -d garden_dx -c "
SELECT query, calls, total_time, mean_time, stddev_time, rows
FROM pg_stat_statements 
WHERE total_time > 1000
ORDER BY total_time DESC 
LIMIT 10;
"

# ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨ç‡
echo
echo "ğŸ“‡ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨ç‡:"
sudo -u postgres psql -d garden_dx -c "
SELECT schemaname,tablename,attname,n_distinct,correlation 
FROM pg_stats 
WHERE schemaname = 'public'
ORDER BY n_distinct DESC;
"
```

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
```bash
#!/bin/bash
# app-performance-monitor.sh

API_ENDPOINT="http://localhost:8000"
LOGFILE="/var/log/garden-dx/performance.log"

# APIå¿œç­”æ™‚é–“æ¸¬å®š
measure_api_response() {
    local endpoint="$1"
    local start_time=$(date +%s%3N)
    
    curl -s -o /dev/null -w "%{http_code}" "$API_ENDPOINT$endpoint"
    
    local end_time=$(date +%s%3N)
    local response_time=$((end_time - start_time))
    
    echo "$(date) API $endpoint: ${response_time}ms" >> "$LOGFILE"
}

# ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å¿œç­”æ™‚é–“æ¸¬å®š
echo "âš¡ APIå¿œç­”æ™‚é–“æ¸¬å®šé–‹å§‹"

measure_api_response "/health"
measure_api_response "/api/auth/user-features"
measure_api_response "/api/estimates?limit=10"
measure_api_response "/api/price-master?limit=10"

# éå»1æ™‚é–“ã®å¹³å‡å¿œç­”æ™‚é–“è¨ˆç®—
echo "ğŸ“Š éå»1æ™‚é–“ã®å¹³å‡å¿œç­”æ™‚é–“:"
awk -v since="$(date -d '1 hour ago' '+%Y-%m-%d %H:%M')" \
    '$1 " " $2 >= since {print $4}' "$LOGFILE" | \
    sed 's/ms//' | \
    awk '{sum+=$1; count++} END {printf "å¹³å‡: %.2fms\n", sum/count}'
```

### ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–
```sql
-- vacuum-analyze.sql
-- å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

-- çµ±è¨ˆæƒ…å ±æ›´æ–°
ANALYZE;

-- ä¸è¦é ˜åŸŸå›å
VACUUM;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å†æ§‹ç¯‰ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
REINDEX DATABASE garden_dx;

-- ãƒ†ãƒ¼ãƒ–ãƒ«çµ±è¨ˆç¢ºèª
SELECT 
    schemaname,
    tablename,
    n_tup_ins as inserts,
    n_tup_upd as updates,
    n_tup_del as deletes,
    n_dead_tup as dead_tuples
FROM pg_stat_user_tables
ORDER BY n_dead_tup DESC;
```

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–
```bash
#!/bin/bash
# cache-optimization.sh

echo "ğŸ”„ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–é–‹å§‹"

# Redis ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèª
REDIS_MEMORY=$(redis-cli info memory | grep used_memory_human | cut -d: -f2)
echo "ğŸ“Š Redis ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: $REDIS_MEMORY"

# æœŸé™åˆ‡ã‚Œã‚­ãƒ¼ã®å‰Šé™¤
EXPIRED_KEYS=$(redis-cli eval "
local keys = redis.call('keys', ARGV[1])
local expired = 0
for i=1,#keys do
    if redis.call('ttl', keys[i]) == -1 then
        redis.call('del', keys[i])
        expired = expired + 1
    end
end
return expired
" 0 "*")

echo "ğŸ—‘ï¸ æœŸé™åˆ‡ã‚Œã‚­ãƒ¼å‰Šé™¤æ•°: $EXPIRED_KEYS"

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°
curl -X POST "$API_ENDPOINT/api/cache/refresh"

echo "âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–å®Œäº†"
```

---

## ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### ğŸ”§ å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

#### æœˆæ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
```bash
#!/bin/bash
# monthly-maintenance.sh

echo "ğŸ—“ï¸ Garden DX æœˆæ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é–‹å§‹"
echo "å®Ÿè¡Œæ—¥æ™‚: $(date)"

# 1. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
echo "ğŸ“‹ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–..."
cd /var/log/garden-dx
for log in *.log; do
    if [ -f "$log" ]; then
        gzip -c "$log" > "archive/$(date +%Y%m)_$log.gz"
        > "$log"  # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¯ãƒªã‚¢
    fi
done

# 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±è¨ˆæ›´æ–°ãƒ»æœ€é©åŒ–
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–..."
sudo -u postgres psql -d garden_dx -f /opt/garden-dx/scripts/vacuum-analyze.sql

# 3. å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
echo "ğŸ—‘ï¸ å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤..."
find /opt/garden-dx/backups -name "*.sql.gz" -mtime +90 -delete
find /opt/garden-dx/backups -name "*.tar.gz" -mtime +90 -delete

# 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒç¢ºèª
echo "ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒç¢ºèª..."
apt list --upgradable | grep -i security

# 5. SSLè¨¼æ˜æ›¸æœŸé™ãƒã‚§ãƒƒã‚¯
echo "ğŸ” SSLè¨¼æ˜æ›¸æœŸé™ãƒã‚§ãƒƒã‚¯..."
/opt/garden-dx/scripts/ssl-renewal.sh

# 6. ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ãƒ¬ãƒãƒ¼ãƒˆ
echo "ğŸ’¾ ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ãƒ¬ãƒãƒ¼ãƒˆ..."
df -h > /opt/garden-dx/reports/disk-usage-$(date +%Y%m).txt

echo "âœ… æœˆæ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Œäº†"
```

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
```bash
#!/bin/bash
# update-application.sh

VERSION="$1"

if [ -z "$VERSION" ]; then
    echo "ä½¿ç”¨æ³•: $0 <version>"
    echo "ä¾‹: $0 v1.1.0"
    exit 1
fi

echo "ğŸš€ Garden DX ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°é–‹å§‹: $VERSION"

# 1. äº‹å‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
echo "ğŸ’¾ äº‹å‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ..."
/opt/garden-dx/scripts/backup-database.sh
/opt/garden-dx/scripts/backup-application.sh

# 2. ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–
echo "ğŸ”§ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–..."
touch /opt/garden-dx/maintenance.flag
sudo systemctl stop garden-frontend garden-backend

# 3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
echo "ğŸ“¦ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°..."
cd /opt/garden-dx
git fetch origin
git checkout "$VERSION"

# 4. ä¾å­˜é–¢ä¿‚æ›´æ–°
echo "ğŸ“š ä¾å­˜é–¢ä¿‚æ›´æ–°..."
cd app && npm ci
cd ../backend && pip install -r requirements.txt

# 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³..."
cd /opt/garden-dx/backend
python -m alembic upgrade head

# 6. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰
echo "ğŸ”¨ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰..."
cd /opt/garden-dx/app
npm run build

# 7. ã‚µãƒ¼ãƒ“ã‚¹å†é–‹
echo "ğŸ”„ ã‚µãƒ¼ãƒ“ã‚¹å†é–‹..."
sudo systemctl start garden-backend garden-frontend

# 8. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
echo "â¤ï¸ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯..."
sleep 30
curl -f http://localhost:8000/health
if [ $? -eq 0 ]; then
    echo "âœ… æ›´æ–°æˆåŠŸ"
    rm -f /opt/garden-dx/maintenance.flag
else
    echo "âŒ æ›´æ–°å¤±æ•— - ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ"
    /opt/garden-dx/scripts/rollback.sh
fi
```

---

## ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œ

### ğŸš¨ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ‰‹é †

#### é‡è¦åº¦åˆ†é¡

| ãƒ¬ãƒ™ãƒ« | èª¬æ˜ | å¯¾å¿œæ™‚é–“ | å¯¾å¿œè€… |
|--------|------|----------|--------|
| P1 | ã‚·ã‚¹ãƒ†ãƒ å…¨åœæ­¢ | 15åˆ†ä»¥å†… | å…¨å“¡ |
| P2 | ä¸»è¦æ©Ÿèƒ½åœæ­¢ | 1æ™‚é–“ä»¥å†… | æ‹…å½“è€…+ç®¡ç†è€… |
| P3 | è»½å¾®ãªæ©Ÿèƒ½éšœå®³ | 4æ™‚é–“ä»¥å†… | æ‹…å½“è€… |
| P4 | æ”¹å–„è¦æœ› | 24æ™‚é–“ä»¥å†… | æ‹…å½“è€… |

#### P1ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œæ‰‹é †
```bash
#!/bin/bash
# p1-incident-response.sh

echo "ğŸš¨ P1ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œé–‹å§‹"
echo "é–‹å§‹æ™‚åˆ»: $(date)"

# 1. ç¾çŠ¶ç¢ºèª
echo "ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª..."
systemctl status garden-frontend garden-backend postgres redis
curl -s http://localhost:8000/health

# 2. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°åé›†
echo "ğŸ“‹ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°åé›†..."
tail -100 /var/log/garden-dx/error.log > /tmp/incident-logs-$(date +%Y%m%d_%H%M%S).log
journalctl -u garden-backend --since "10 minutes ago" >> /tmp/incident-logs-$(date +%Y%m%d_%H%M%S).log

# 3. ç·Šæ€¥å›å¾©è©¦è¡Œ
echo "ğŸ”„ ç·Šæ€¥å›å¾©è©¦è¡Œ..."

# ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
sudo systemctl restart garden-backend garden-frontend

# 10ç§’å¾…æ©Ÿ
sleep 10

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl -f http://localhost:8000/health
if [ $? -eq 0 ]; then
    echo "âœ… ã‚·ã‚¹ãƒ†ãƒ å›å¾©æˆåŠŸ"
    exit 0
fi

# 4. ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã‹ã‚‰ã®åˆ‡ã‚Šé›¢ã—
echo "âš ï¸ ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã‹ã‚‰åˆ‡ã‚Šé›¢ã—..."
# nginxè¨­å®šã‹ã‚‰è©²å½“ã‚µãƒ¼ãƒãƒ¼ã‚’ç„¡åŠ¹åŒ–

# 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ç¢ºèª..."
sudo -u postgres psql -c "SELECT version();"

# 6. æœ€æ–°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ã®å¾©æ—§
echo "ğŸ’¾ æœ€æ–°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ã®å¾©æ—§..."
LATEST_BACKUP=$(ls -t /opt/garden-dx/backups/*.sql.gz | head -1)
if [ -n "$LATEST_BACKUP" ]; then
    /opt/garden-dx/scripts/restore-database.sh "$LATEST_BACKUP"
fi

echo "ğŸ P1ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œå®Œäº†"
```

#### ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆé€šçŸ¥
```bash
#!/bin/bash
# incident-notification.sh

SEVERITY="$1"
DESCRIPTION="$2"
IMPACT="$3"

# Slacké€šçŸ¥
curl -X POST -H 'Content-type: application/json' \
    --data "{
        \"channel\": \"#garden-dx-incidents\",
        \"username\": \"Garden DX Alert\",
        \"text\": \"ğŸš¨ ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç™ºç”Ÿ\",
        \"attachments\": [{
            \"color\": \"danger\",
            \"fields\": [
                {\"title\": \"é‡è¦åº¦\", \"value\": \"$SEVERITY\", \"short\": true},
                {\"title\": \"èª¬æ˜\", \"value\": \"$DESCRIPTION\", \"short\": false},
                {\"title\": \"å½±éŸ¿\", \"value\": \"$IMPACT\", \"short\": false},
                {\"title\": \"æ™‚åˆ»\", \"value\": \"$(date)\", \"short\": true}
            ]
        }]
    }" \
    https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK

# ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
cat << EOF | mail -s "Garden DX ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ: $SEVERITY" admin@garden-dx.com
ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãŒç™ºç”Ÿã—ã¾ã—ãŸ

é‡è¦åº¦: $SEVERITY
èª¬æ˜: $DESCRIPTION
å½±éŸ¿: $IMPACT
ç™ºç”Ÿæ™‚åˆ»: $(date)

å¯¾å¿œã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚
EOF
```

### ğŸ“Š ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¾Œåˆ†æ

#### ãƒã‚¹ãƒˆãƒ¢ãƒ¼ã‚¿ãƒ ï¼ˆäº‹å¾Œåˆ†æï¼‰
```bash
#!/bin/bash
# postmortem-template.sh

INCIDENT_ID="$1"
DATE=$(date +%Y-%m-%d)

cat > "/opt/garden-dx/incidents/postmortem-$INCIDENT_ID-$DATE.md" << EOF
# ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆäº‹å¾Œåˆ†æãƒ¬ãƒãƒ¼ãƒˆ

## åŸºæœ¬æƒ…å ±
- **ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆID**: $INCIDENT_ID
- **ç™ºç”Ÿæ—¥æ™‚**: 
- **è§£æ±ºæ—¥æ™‚**: 
- **å½±éŸ¿æ™‚é–“**: 
- **é‡è¦åº¦**: 

## æ¦‚è¦
<!-- ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®æ¦‚è¦ã‚’è¨˜è¼‰ -->

## ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
- **XX:XX** - ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç™ºç”Ÿ
- **XX:XX** - æ¤œçŸ¥ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
- **XX:XX** - å¯¾å¿œé–‹å§‹
- **XX:XX** - æš«å®šå¯¾å¿œ
- **XX:XX** - æ ¹æœ¬å¯¾å¿œ
- **XX:XX** - è§£æ±ºç¢ºèª

## æ ¹æœ¬åŸå› 
<!-- æ ¹æœ¬åŸå› ã®è©³ç´°åˆ†æ -->

## å½±éŸ¿ç¯„å›²
- **å½±éŸ¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°**: 
- **å½±éŸ¿æ©Ÿèƒ½**: 
- **ãƒ“ã‚¸ãƒã‚¹å½±éŸ¿**: 

## å¯¾å¿œå†…å®¹
### æš«å®šå¯¾å¿œ
<!-- ç·Šæ€¥æ™‚ã®å¯¾å¿œå†…å®¹ -->

### æ ¹æœ¬å¯¾å¿œ
<!-- æ ¹æœ¬çš„ãªè§£æ±ºç­– -->

## äºˆé˜²ç­–
<!-- å†ç™ºé˜²æ­¢ç­– -->

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ 
- [ ] ã‚¢ã‚¯ã‚·ãƒ§ãƒ³1 - æ‹…å½“è€… - æœŸé™
- [ ] ã‚¢ã‚¯ã‚·ãƒ§ãƒ³2 - æ‹…å½“è€… - æœŸé™

## å­¦ã‚“ã ã“ã¨
<!-- ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã‹ã‚‰å¾—ãŸæ•™è¨“ -->
EOF

echo "ğŸ“Š ãƒã‚¹ãƒˆãƒ¢ãƒ¼ã‚¿ãƒ  ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ"
echo "ãƒ•ã‚¡ã‚¤ãƒ«: /opt/garden-dx/incidents/postmortem-$INCIDENT_ID-$DATE.md"
```

---

## é‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

### ğŸ› ï¸ ä¾¿åˆ©ãªé‹ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆé›†

#### ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±åé›†
```bash
#!/bin/bash
# system-info.sh

echo "ğŸ–¥ï¸ Garden DX ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±åé›†"
echo "å®Ÿè¡Œæ—¥æ™‚: $(date)"
echo "================================"

# OSæƒ…å ±
echo "ğŸ“‹ OSæƒ…å ±:"
cat /etc/os-release | grep -E "(NAME|VERSION)"
uname -r

# ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æƒ…å ±
echo
echo "ğŸ”§ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æƒ…å ±:"
echo "CPU: $(grep -m1 'model name' /proc/cpuinfo | cut -d: -f2 | xargs)"
echo "ãƒ¡ãƒ¢ãƒª: $(free -h | grep Mem | awk '{print $2}')"
echo "ãƒ‡ã‚£ã‚¹ã‚¯: $(df -h / | tail -1 | awk '{print $2}')"

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹
echo
echo "ğŸ”„ ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹:"
systemctl is-active garden-frontend garden-backend postgres redis

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±
echo
echo "ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±:"
ip route get 8.8.8.8 | head -1 | awk '{print "IPã‚¢ãƒ‰ãƒ¬ã‚¹:", $7}'
ss -tuln | grep -E "(3000|8000|5432|6379)"

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±
echo
echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±:"
sudo -u postgres psql -d garden_dx -c "
SELECT 
    current_database() as database,
    version() as version,
    pg_size_pretty(pg_database_size(current_database())) as size;
"

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±
echo
echo "ğŸ“¦ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±:"
cd /opt/garden-dx
echo "ãƒãƒ¼ã‚¸ãƒ§ãƒ³: $(git describe --tags --always)"
echo "æœ€çµ‚ã‚³ãƒŸãƒƒãƒˆ: $(git log -1 --format='%h %s')"
```

#### ãƒ­ã‚°è§£æ
```bash
#!/bin/bash
# log-analyzer.sh

DAYS="${1:-1}"  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1æ—¥

echo "ğŸ“Š Garden DX ãƒ­ã‚°è§£æï¼ˆéå» $DAYS æ—¥é–“ï¼‰"
echo "è§£ææ™‚åˆ»: $(date)"

# ã‚¨ãƒ©ãƒ¼çµ±è¨ˆ
echo "âŒ ã‚¨ãƒ©ãƒ¼çµ±è¨ˆ:"
find /var/log/garden-dx -name "*.log" -mtime -$DAYS -exec \
    grep -h "ERROR\|CRITICAL" {} \; | \
    awk '{print $1}' | sort | uniq -c | sort -nr

# API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ©ç”¨çµ±è¨ˆ
echo
echo "ğŸ“ˆ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ©ç”¨çµ±è¨ˆ:"
grep "GET\|POST\|PUT\|DELETE" /var/log/garden-dx/api.log | \
    grep -o '"[A-Z]* /[^"]*"' | \
    sort | uniq -c | sort -nr | head -10

# å¿œç­”æ™‚é–“çµ±è¨ˆ
echo
echo "âš¡ å¹³å‡å¿œç­”æ™‚é–“:"
grep "response_time" /var/log/garden-dx/api.log | \
    awk '{sum+=$NF; count++} END {printf "å¹³å‡: %.2fms\n", sum/count}'

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£
echo
echo "ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£:"
grep "user_login" /var/log/garden-dx/auth.log | \
    awk '{print $3}' | sort | uniq -c | sort -nr | head -10
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
```bash
#!/bin/bash
# db-maintenance.sh

echo "ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é–‹å§‹"

# 1. æ¥ç¶šæ•°ç¢ºèª
echo "ğŸ“Š ç¾åœ¨ã®æ¥ç¶šæ•°:"
sudo -u postgres psql -d garden_dx -c "
SELECT count(*) as connections 
FROM pg_stat_activity 
WHERE datname = 'garden_dx';"

# 2. ãƒ†ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ã‚ºç¢ºèª
echo
echo "ğŸ“ ãƒ†ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ã‚º TOP10:"
sudo -u postgres psql -d garden_dx -c "
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size
FROM pg_tables 
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC
LIMIT 10;"

# 3. æœªä½¿ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª
echo
echo "ğŸ” æœªä½¿ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:"
sudo -u postgres psql -d garden_dx -c "
SELECT 
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes
WHERE idx_scan = 0
ORDER BY schemaname, tablename;"

# 4. VACUUM ANALYZEå®Ÿè¡Œ
echo
echo "ğŸ§¹ VACUUM ANALYZEå®Ÿè¡Œä¸­..."
sudo -u postgres psql -d garden_dx -c "VACUUM ANALYZE;"

echo "âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Œäº†"
```

---

## ãƒ­ã‚°ç®¡ç†

### ğŸ“‹ ãƒ­ã‚°è¨­å®šãƒ»ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

#### rsyslogè¨­å®š
```bash
# /etc/rsyslog.d/garden-dx.conf
# Garden DX ãƒ­ã‚°è¨­å®š

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°
if $programname == 'garden-dx' then /var/log/garden-dx/app.log
& stop

# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
if $msg contains 'ERROR' or $msg contains 'CRITICAL' then /var/log/garden-dx/error.log
& stop

# èªè¨¼ãƒ­ã‚°
if $msg contains 'authentication' then /var/log/garden-dx/auth.log
& stop

# APIã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°
if $msg contains 'api_access' then /var/log/garden-dx/api.log
& stop
```

#### logrotateè¨­å®š
```bash
# /etc/logrotate.d/garden-dx
/var/log/garden-dx/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 garden garden
    sharedscripts
    postrotate
        systemctl reload rsyslog
        systemctl reload garden-backend
    endscript
}

# ç‰¹åˆ¥ãªãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆé‡è¦ãƒ­ã‚°ï¼‰
/var/log/garden-dx/error.log {
    hourly
    rotate 168  # 1é€±é–“åˆ†
    compress
    delaycompress
    notifempty
    create 0644 garden garden
}
```

#### ãƒ­ã‚°ç›£è¦–ãƒ»åˆ†æ
```bash
#!/bin/bash
# log-monitor.sh

LOGDIR="/var/log/garden-dx"

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ç›£è¦–
tail -f "$LOGDIR/error.log" | while read line; do
    echo "[$(date)] ERROR DETECTED: $line"
    
    # é‡è¦ãªã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡
    if echo "$line" | grep -q "CRITICAL\|database.*down\|authentication.*failed"; then
        send_alert_email "é‡è¦ã‚¨ãƒ©ãƒ¼æ¤œå‡º" "$line"
    fi
done &

# æ¯åˆ†ã®ãƒ­ã‚°çµ±è¨ˆ
while true; do
    echo "$(date) - ã‚¨ãƒ©ãƒ¼æ•°: $(tail -100 $LOGDIR/error.log | wc -l)"
    echo "$(date) - API ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°: $(tail -100 $LOGDIR/api.log | wc -l)"
    sleep 60
done
```

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆãƒ»ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### ç·Šæ€¥é€£çµ¡ä½“åˆ¶

#### ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †

1. **Level 1**: é‹ç”¨æ‹…å½“è€…ï¼ˆåˆæœŸå¯¾å¿œï¼‰
2. **Level 2**: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ï¼ˆæŠ€è¡“çš„å•é¡Œï¼‰
3. **Level 3**: é–‹ç™ºãƒãƒ¼ãƒ ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å•é¡Œï¼‰
4. **Level 4**: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆï¼ˆè¨­è¨ˆå•é¡Œï¼‰

#### é€£çµ¡å…ˆãƒªã‚¹ãƒˆ
```yaml
# contacts.yml
emergency_contacts:
  level1:
    - name: "é‹ç”¨æ‹…å½“è€…A"
      phone: "090-XXXX-XXXX"
      email: "ops-a@garden-dx.com"
      slack: "@ops-a"
  
  level2:
    - name: "ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…"
      phone: "090-YYYY-YYYY"
      email: "sysadmin@garden-dx.com"
      slack: "@sysadmin"
  
  level3:
    - name: "é–‹ç™ºãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ‰"
      phone: "090-ZZZZ-ZZZZ"
      email: "dev-lead@garden-dx.com"
      slack: "@dev-lead"

escalation_rules:
  - condition: "P1ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ"
    immediate_notify: ["level1", "level2", "level3"]
  - condition: "P2ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ"
    immediate_notify: ["level1", "level2"]
  - condition: "30åˆ†æœªè§£æ±º"
    escalate_to: "level3"
```

---

## ğŸ“Š é‹ç”¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»KPI

### ä¸»è¦æŒ‡æ¨™

| æŒ‡æ¨™ | ç›®æ¨™å€¤ | æ¸¬å®šæ–¹æ³• | é »åº¦ |
|------|--------|----------|------|
| ç¨¼åƒç‡ | 99.9%+ | ã‚·ã‚¹ãƒ†ãƒ ç›£è¦– | 24/7 |
| å¿œç­”æ™‚é–“ | <2ç§’ | APIç›£è¦– | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ  |
| ã‚¨ãƒ©ãƒ¼ç‡ | <0.1% | ãƒ­ã‚°è§£æ | æ™‚é–“æ¯ |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆåŠŸç‡ | 100% | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ­ã‚° | æ—¥æ¬¡ |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆ | 0ä»¶ | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚° | æ—¥æ¬¡ |

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**é‹ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**ï¼ˆGrafanaï¼‰
- ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒçŠ¶æ³
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- ã‚¨ãƒ©ãƒ¼ç‡ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆçŠ¶æ³
- ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨ç‡
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ´»å‹•çŠ¶æ³

---

**Garden DX ã‚·ã‚¹ãƒ†ãƒ é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ« v1.0**  
**æœ€çµ‚æ›´æ–°æ—¥: 2024å¹´7æœˆ6æ—¥**  
**ä½œæˆè€…: Garden DX é‹ç”¨ãƒãƒ¼ãƒ **

Â© 2024 Garden DX. All rights reserved.